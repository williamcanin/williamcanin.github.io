<!DOCTYPE html><html id="top" lang="pt-BR" data-theme="light"><head><meta name="viewport" content="width=device-width,initial-scale=1"><meta charset="utf-8"><title>Transa√ß√µes no banco de dados atrav√©s do shell script | William Canin</title><meta name="description" content="O shell script n√£o √© s√≥ uma linguagem para faze..."><meta name="author" content="William C. Canin"><meta property="og:title" content="Transa√ß√µes no banco de dados atrav√©s do shell script"><meta property="og:locale" content="pt_BR"><meta property="og:locale:alternate" content="en_US"><meta property="og:description" content="O shell script n√£o √© s√≥ uma linguagem para faze..."><link rel="canonical" href="https://williamcanin.github.io/blog/transacoes-no-banco-de-dados-atraves-do-shellscript/"><meta property="og:url" content="https://williamcanin.github.io/blog/transacoes-no-banco-de-dados-atraves-do-shellscript/"><meta property="og:site_name" content="William Canin"><meta property="og:type" content="website"><meta name="twitter:card" content="summary"><meta property="twitter:title" content="William Canin"><meta name="robots" content="index, follow"><script type="application/ld+json">{"@context":"https://schema.org","@type":"WebSite","description":"O shell script n√£o √© s√≥ uma linguagem para faze...","headline":"William Canin","name":"William Canin","url":"https://williamcanin.github.io/blog/transacoes-no-banco-de-dados-atraves-do-shellscript/"}</script><script src="/assets/js/no_inframe.js"></script><meta http-equiv="Content-Security-Policy" content=" default-src 'self'; img-src 'self' data: https://www.google.com https://media0.giphy.com https://media4.giphy.com https://media.giphy.com https://github.githubassets.com; script-src 'self' https://www.google.com https://www.gstatic.com https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://giscus.app https://disqus.com https://script.google.com; style-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com https://fonts.googleapis.com https://cdn.jsdelivr.net https://giscus.app https://disqus.com; font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com data:; connect-src 'self' https://www.google.com https://api.github.com https://script.google.com https://script.googleusercontent.com; frame-src https://www.google.com https://www.youtube.com https://giscus.app https://disqus.com; object-src 'none'; base-uri 'self'; form-action 'self'; "><meta http-equiv="Strict-Transport-Security" content="max-age=31536000; includeSubDomains; preload"><meta http-equiv="Cross-Origin-Opener-Policy" content="same-origin"><meta http-equiv="Cross-Origin-Embedder-Policy" content="require-corp"><link rel="icon" type="image/png" href="/assets/images/favicon.png"><link rel="apple-touch-icon" href="/assets/images/favicon.png"><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=SUSE+Mono:ital,wght@0,100..800;1,100..800&display=swap" rel="stylesheet"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inconsolata:400,700&amp;display=swap"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Inconsolata:wght@200..900&family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&family=Open+Sans:ital,wght@0,300..800;1,300..800&family=Roboto+Mono:ital,wght@0,100..700;1,100..700&family=Ubuntu:ital,wght@0,300;0,400;0,500;0,700;1,300;1,400;1,500;1,700&display=swap" rel="stylesheet"><link rel="stylesheet" href="/assets/vendor/bootstrap/css/bootstrap.min.css"><script src="/assets/js/theme_load.js"></script><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="/assets/css/custom.css"><link rel="alternate" type="application/atom+xml" title="William Canin" href="/feed.xml"></head><body data-layout="post" data-terminal-enabled="true" style="font-family:monospace!important;font-size:15.45px!important;letter-spacing:-.05em!important"><div class="container-fluid"><div class="modal fade" id="avatarModal" tabindex="-1" aria-hidden="true"><div class="modal-dialog modal-dialog-centered"><div class="modal-content bg-transparent border-0 shadow-none"><div class="modal-body d-flex justify-content-center"><img id="modalAvatar" class="avatar-img" src="" alt=""></div></div></div></div><header class="header" style="max-width:860px!important;font-family:monospace!important;font-size:15.45px!important;letter-spacing:-.05em!important"><div class="row"><div class="col-sm-3 d-flex flex-column justify-content-end header__column-home"><span>[<span class="spacer">üè†</span><a class="" href="/">/home</a>&nbsp;]</span></div><div class="col-sm-6 d-flex flex-column justify-content-end"><span class="title">Hey, I'm William!</span> <small class="description">Thinker on hacking, digital well-being, Linux.</small></div><div class="col-sm-3 d-flex justify-content-end avatar"><div class="avatar-wrapper"><div class="avatar-flipper light-theme can-flip"><div class="avatar-card"><div class="avatar-front"><img id="avatarImgLight" class="avatar-img" src="/assets/images/wcanin_light.png" alt="William Canin"></div><div class="avatar-back"><img class="avatar-img" src="/assets/images/wcanin_back.png" alt="William Canin"></div></div></div><div class="avatar-flipper dark-theme can-flip"><div class="avatar-card"><div class="avatar-front"><img id="avatarImgDark" class="avatar-img" src="/assets/images/wcanin_dark.png" alt="William Canin"></div><div class="avatar-back"><img class="avatar-img" src="/assets/images/wcanin_back.png" alt="William Canin"></div></div></div></div></div></div><div class="row"><div class="col-sm d-flex justify-content-center"><div class="line-separator"></div></div></div><div class="row"><div class="col-sm d-flex justify-content-center menu"><div>weblog&nbsp;¬ª<div class="menu-wrap-link"><span class="spacer">üìù</span><a class="" href="/blog/">posts</a><strong class="separator">;</strong></div><span style="display:inline-block"><span class="spacer">üîç</span><a id="blog-search__btn" href="/blog/?search=open">pesquisar</a><strong class="separator">;</strong></span><div class="menu-wrap-link"><span class="spacer">üîñ</span><a class="" href="/blog/tags/">tags</a><strong class="separator">;</strong></div><div class="menu-wrap-link"><span class="spacer">üì∞</span><a href="/feed.xml">feed</a><strong class="separator">;</strong></div></div></div></div><div class="row justify-content-end"><div class="col-sm-2 d-flex justify-content-end"><span id="toggle-theme"><i class="fa-solid fa-moon"></i></span></div></div></header><div class="default" style="max-width:860px!important"><main class="content"><article id="post" class="post background_focus" itemscope itemtype="http://schema.org/BlogPosting"><div class="row"><header class="post-header"><h1 class="post-title p-name" itemprop="name headline">¬ª&nbsp;Transa√ß√µes no banco de dados atrav√©s do Shell script</h1><div class="row post-meta"><div class="col-sm d-flex justify-content-start"><time class="dt-published" datetime="2018-08-28T08:23:33+00:00" itemprop="datePublished">28 Ago, 2018</time></div><div class="col-sm d-flex justify-content-end"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">Postado por:&nbsp;William C. Canin</span></span></div><div class="post-reading_time">[&nbsp;Leia aproximadamente em 10 minutos&nbsp;]</div></div></header><div class="post-content e-content" itemprop="articleBody"><nav id="toc" style="border-top-left-radius:0!important;border-top-right-radius:0!important" class="toc background_focus" data-toc-selector=".post-content" data-toc-max-level="3" data-toc-scroll-offset="20" data-btn-show="Abrir" data-btn-hidden="Fechar"><div class="toc-head"><h2>√çndice</h2><button class="toc-toggle" aria-expanded="true" type="button"></button></div><div class="toc-list-wrapper"><ul class="toc-list" role="list"></ul><p class="toc-empty" style="display:none">No titles found. Remove TOC!</p></div></nav><p>Ol√° pessoas, vamos falar de Shell script, que √© algo que gosto muito. :)</p><h1 id="introdu√ß√£o">Introdu√ß√£o</h1><p>Bom, se voc√™ √© usu√°rio Linux sabe muito bem o que √© <a href="https://pt.wikipedia.org/wiki/Shell_script" target="_blank">Shell Script</a>, uma linguagem usuda em v√°rios sistemas operativos, at√© aqui tudo bem, mas‚Ä¶o que muitos n√£o sabem √© d√° para fazer transa√ß√µes no banco de dados atrav√©s da mesma.</p><ul><li>Voc√™: S√©rio?</li><li>Eu: S√©rio cara.</li></ul><p>O que vamos ver neste post √© exatamente isso, uma conex√£o com um banco de dados; cria√ß√£o de um database; e a cria√ß√£o de uma tabela. N√£o irei abordar um CRUD completo, pois com base na conex√£o e cria√ß√£o de uma tabela, voc√™ j√° ser√° apto para navegar em sua mente e realizar as demais transa√ß√µes no banco de dados, tendo como requerimento apenas conhecimento de PL/SQL.</p><p>Os bancos de dados que irei abordar aqui ser√£o o <a href="https://www.postgresql.org" target="_blank">PostgreSQL</a> e o <a href="https://www.mysql.com" target="_blank">MySQL</a>, ent√£o suponho que voc√™ j√° tenha um dos dois instalados em sua m√°quina; com as configura√ß√µes de usu√°rio e senha realizadas; e o servi√ßo iniciado.</p><h1 id="requerimentos">Requerimentos</h1><ul><li>PostgreSQL ou Mysql instalado.</li><li>Conhecimento b√°sico em PL/SQL.</li><li>For√ßa de vontade :D</li></ul><h1 id="postgresql">PostgreSQL</h1><h2 id="preparando-ambiente">Preparando ambiente</h2><p>Por padr√£o, o PostgreSQL j√° cria um usu√°rio e uma role com o nome <strong>postgres</strong>, voc√™ pode fazer um teste de conex√£o com o seguinte comando:</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>psql <span class="nt">-U</span> postgres</code></pre></figure><p>ou</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span><span class="nb">sudo</span> <span class="nt">-u</span> postgres psql</code></pre></figure><blockquote><p>NOTA: O usu√°rio <strong>postgres</strong> tem permiss√£o de SUPERUSER, ent√£o voc√™ pode criar outros usu√°rios, databases, tabelas e outros respectivas permiss√µes com ele.</p></blockquote><h3 id="criando-um-database-no-postgresql">Criando um DATABASE no PostgreSQL</h3><p>Uma vez que voc√™ j√° est√° conectado ao <code class="language-plaintext highlighter-rouge">psql</code> com usu√°rio <strong>postgres</strong>, vamos criar um DATABASE onde vamos trabalhar nossas transa√ß√µes:</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">postgres</span><span class="o">=</span><span class="c"># CREATE DATABASE my_db;</span></code></pre></figure><blockquote><p>NOTA: Mais adiante, criamos nossa DATABASE atrav√©s de uma fun√ß√£o em nosso projeto, por√©m, vale lembrar que o <strong>CREATE DATABASE</strong> no PostgreSQL n√£o tem op√ß√£o <strong>IF NOT EXISTS</strong> e s√≥ podemos executar uma √∫nica instru√ß√£o do <strong>CREATE DATABASE</strong>, n√£o conseguimos executa-lo dentro de um bloco de transa√ß√£o. Com essas informa√ß√µes, foi usado outras t√©cnicas com Shell Script para verificar se DATABASE n√£o existe e assim criar o mesmo.</p></blockquote><h2 id="iniciando-projeto">Iniciando projeto</h2><h2 id="criando-pasta-de-ambiente-do-projeto">Criando pasta de ambiente do projeto</h2><p>Vamos criar uma pasta para nosso projeto e entrar na mesma com o comando abaixo:</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">mkdir</span> ~/sh_postgresql<span class="p">;</span> <span class="nb">cd</span> <span class="nv">$_</span></code></pre></figure><h2 id="criando-arquivo-de-configura√ß√£o">Criando arquivo de configura√ß√£o</h2><p>Para fins de boas normas de projeto, vamos criar o arquivo <strong>config.conf</strong> na base do nosso projeto, e armazenar nossas vari√°veis global.</p><p>Conte√∫do do arquivo: <strong>config.conf</strong></p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">DB</span><span class="o">=</span><span class="s2">"my_db"</span>
<span class="nv">HOST</span><span class="o">=</span><span class="s2">"localhost"</span>
<span class="nv">PORT</span><span class="o">=</span><span class="s2">"5432"</span>
<span class="nv">USER</span><span class="o">=</span><span class="s2">"postgres"</span>
<span class="nv">TABLE</span><span class="o">=</span><span class="s2">"films"</span></code></pre></figure><p>Essas vari√°veis v√£o ser respons√°veis por qualquer tipo de transa√ß√£o no banco de dados.</p><h2 id="criando-bibliotecas-para-nosso-projeto">Criando bibliotecas para nosso projeto</h2><p>Sempre que criamos um projeto, √© interessante dividir partes do nosso c√≥digo e fazer essas partes virarem bibliotecas, ou seja, pequenos trechos de c√≥digo onde podemos importar a qualquer momento. Vamos criar nossas bibliotecas na pasta <strong>libs</strong>.</p><h3 id="biblioteca-create_databasebash">Biblioteca <strong>create_database.bash</strong></h3><p>A primeira <strong>lib</strong> (biblioteca) que vamos criar √© a <strong>create_database.bash</strong>. Essa biblioteca ir√° conter uma fun√ß√£o para criar nossa DATABASE caso ela n√£o exista.</p><p>Conte√∫do do arquivo: <strong>libs/create_database.bash</strong></p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="k">function </span>_create_database<span class="o">()</span> <span class="o">{</span>
  psql <span class="nt">-h</span> <span class="nv">$HOST</span> <span class="nt">-p</span> <span class="nv">$PORT</span> <span class="nt">-U</span> <span class="nv">$USER</span> <span class="nt">-tc</span> <span class="s2">"SELECT 1 FROM pg_database WHERE datname = '</span><span class="nv">$DB</span><span class="s2">'"</span> | <span class="nb">grep</span> <span class="nt">-q</span> 1 <span class="o">||</span> psql <span class="nt">-h</span> <span class="nv">$HOST</span> <span class="nt">-p</span> <span class="nv">$PORT</span> <span class="nt">-U</span> <span class="nv">$USER</span> <span class="nt">-c</span> <span class="s2">"CREATE DATABASE </span><span class="nv">$DB</span><span class="s2">"</span>
<span class="o">}</span></code></pre></figure><p>Em <a href="#criando-um-database-no-postgresql">Criando um DATABASE no PostgreSQL</a>, criamos nosso DATABASE manualmente atrav√©s do <strong>psql</strong>, mas caso n√£o criassemos, essa fun√ß√£o j√° seria respons√°vel por criar.</p><h3 id="biblioteca-create_tablebash">Biblioteca <strong>create_table.bash</strong></h3><p>Outra <strong>lib</strong> (biblioteca) que vamos criar √© a <strong>create_table.bash</strong>. Essa bibliotea ir√° conter uma fun√ß√£o para criar nossa TABLE. Voc√™ pode ser bem mais din√¢mico ao criar suas ‚Äú<em>libs</em>‚Äù, como esse √© um post para apenas lhe dar uma ideia, vou ser bem direto nessa biblioteca de cria√ß√£o de TABLE.</p><p>Conte√∫do do arquivo: <strong>libs/create_table.bash</strong></p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="code"><pre><span class="k">function </span>_create_table<span class="o">()</span> <span class="o">{</span>
  psql <span class="nt">-h</span> <span class="nv">$HOST</span> <span class="nt">-p</span> <span class="nv">$PORT</span> <span class="nt">-U</span> <span class="nv">$USER</span> <span class="nt">-d</span> <span class="nv">$DB</span> <span class="o">&lt;&lt;</span> <span class="no">EOF</span><span class="sh">

  </span><span class="se">\c</span><span class="sh"> DB

  CREATE TABLE IF NOT EXISTS </span><span class="nv">$TABLE</span><span class="sh"> (
    id          char(5) CONSTRAINT firstkey PRIMARY KEY,
    title       varchar(40) NOT NULL,
    did         integer NOT NULL,
    date_prod   date,
    kind        varchar(10),
    len         interval hour to minute
  );
</span><span class="no">EOF
</span><span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></figure><h2 id="criando-o-programa-principal">Criando o programa principal</h2><p>Vamos agora criar um arquivo chamando <strong>setup.bash</strong>, nesse arquivo iremos carregar nosso arquivo de configura√ß√£o (<strong>config.conf</strong>) e nossas <em>libs</em>. Ele tamb√©m ter√° um menu de intera√ß√£o com o usu√°rio.</p><p>Conte√∫do do arquivo: <strong>setup.bash</strong></p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td><td class="code"><pre><span class="c">#!/usr/bin/env bash</span>

<span class="nb">source </span>config.conf

<span class="nv">libs</span><span class="o">=</span><span class="s2">"</span><span class="si">$(</span><span class="nb">ls</span> ./libs/<span class="k">*</span>.bash<span class="si">)</span><span class="s2">"</span>
<span class="k">for </span>lib <span class="k">in</span> <span class="nv">$libs</span><span class="p">;</span> <span class="k">do
  </span><span class="nb">source</span> <span class="nv">$lib</span>
<span class="k">done

case</span> <span class="nv">$1</span> <span class="k">in
  </span>createtb<span class="p">)</span>
    _create_database
    _create_table
  <span class="p">;;</span>
  <span class="k">*</span><span class="p">)</span>
    <span class="nb">printf</span> <span class="s2">"Using: </span><span class="nv">$0</span><span class="s2"> { createtb }"</span>
  <span class="p">;;</span>
<span class="k">esac</span>
<span class="nb">exit </span>0
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></figure><h2 id="estrutura-do-projeto-para-postgresql">Estrutura do projeto para PostgreSQL</h2><p>A √°rvore do nosso projeto ficou assim:</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">.</span>
‚îú‚îÄ‚îÄ config.conf
‚îú‚îÄ‚îÄ libs
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ create_database.bash
‚îÇ¬†¬† ‚îî‚îÄ‚îÄ create_table.bash
‚îî‚îÄ‚îÄ setup.bash</code></pre></figure><h2 id="executando-nosso-programa">Executando nosso programa</h2><p>Depois de ter criado todos arquivos, chegou a hora de fazer nosso programa ser executado. Para isso fa√ßa:</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">chmod</span> +x setup.bash
bash setup.bash createtb</code></pre></figure><p>Se tudo ocorreu bem, a tabela ($DB) j√° foi criada no banco de dados. Voc√™ pode executar os comandos abaixo e verificar:</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">source </span>config.conf <span class="o">&amp;&amp;</span> psql <span class="nt">-h</span> <span class="nv">$HOST</span> <span class="nt">-p</span> <span class="nv">$PORT</span> <span class="nt">-U</span> <span class="nv">$USER</span> <span class="nt">-d</span> <span class="nv">$DB</span></code></pre></figure><p>Dentro do psql, execute o comando <strong>\dt</strong> para listar as TABLES desse DATABASE:</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">my_db</span><span class="o">=</span><span class="c"># \dt</span>
            Lista de rela√ß√µes
 Esquema | Nome  |  Tipo  |   Dono
<span class="nt">---------</span>+-------+--------+----------
 public  | films | tabela | postgres
<span class="o">(</span>1 registro<span class="o">)</span></code></pre></figure><h1 id="mysql">MySQL</h1><h2 id="preparando-ambiente-1">Preparando ambiente</h2><p>Antes de come√ßar, precisamos verificar se temos acesso a conex√£o com o MySQL. Se voc√™ instalou e configurou normalmente, voc√™ pode executar o comando abaixo para logar informando a senha do MySQL configurada:</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>mysql <span class="nt">-u</span> root <span class="nt">-p</span></code></pre></figure><p>Se voc√™ se conectou, j√° podemos prosseguir com os passos seguintes.</p><h2 id="iniciando-projeto-1">Iniciando projeto</h2><h2 id="criando-pasta-de-ambiente-do-projeto-1">Criando pasta de ambiente do projeto</h2><p>Vamos criar uma pasta para nosso projeto de <strong>MySQL</strong> e entrar na mesma com o comando abaixo:</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">mkdir</span> ~/sh_mysql<span class="p">;</span> <span class="nb">cd</span> <span class="nv">$_</span></code></pre></figure><h2 id="criando-arquivo-de-configura√ß√£o-1">Criando arquivo de configura√ß√£o</h2><p>Como fizemos no projeto para o <strong>PostgreSQL</strong>, vamos criar p arquivo <strong>config.conf</strong> na base do nosso projeto.</p><p>Conte√∫do do arquivo: <strong>config.conf</strong></p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">DB</span><span class="o">=</span><span class="s2">"my_db"</span>
<span class="nv">HOST</span><span class="o">=</span><span class="s2">"localhost"</span>
<span class="nv">PORT</span><span class="o">=</span><span class="s2">"3306"</span>
<span class="nv">USER</span><span class="o">=</span><span class="s2">"root"</span>
<span class="nv">PASSWORD</span><span class="o">=</span><span class="s2">""</span>
<span class="nv">TABLE</span><span class="o">=</span><span class="s2">"cartoons"</span></code></pre></figure><h2 id="criando-bibliotecas-para-nosso-projeto-1">Criando bibliotecas para nosso projeto</h2><p>Vamos repetir o mesmo conceito que fizemos para o PostgreSQL, criando nossas bibliotecas na pasta <strong>libs</strong> do projeto.</p><h3 id="biblioteca-create_databasebash-1">Biblioteca <strong>create_database.bash</strong></h3><p>Diferente do PostgreSQL, o <strong>MySQL</strong> contem uma op√ß√£o de <strong>IF NOT EXISTS</strong> para cria√ß√£o de DATABASES, com isso n√£o precisamos fazer a verifica√ß√£o via Shell Script como fizemos com o projeto do PostgreSQL. Com a pr√≥pria instru√ß√£o SQL do MySQL, podemos fazer essa checagem.</p><p>Conte√∫do do arquivo: <strong>libs/create_database.bash</strong></p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="k">function </span>_create_database<span class="o">()</span> <span class="o">{</span>
  mysql <span class="nt">--host</span><span class="o">=</span><span class="nv">$HOST</span> <span class="nt">--port</span><span class="o">=</span><span class="nv">$PORT</span> <span class="nt">--user</span><span class="o">=</span><span class="nv">$USER</span> <span class="nt">--password</span><span class="o">=</span><span class="nv">$PASSWORD</span> <span class="o">&lt;&lt;</span> <span class="no">EOF</span><span class="sh">
  CREATE DATABASE IF NOT EXISTS </span><span class="se">\`</span><span class="nv">$DB</span><span class="se">\`</span><span class="sh">;
</span><span class="no">EOF
</span><span class="o">}</span></code></pre></figure><h3 id="biblioteca-create_tablebash-1">Biblioteca <strong>create_table.bash</strong></h3><p>Diferentemente do PostgreSQL tamb√©m, com o MySQL voc√™ deve criar delimitadores para executar v√°rias instru√ß√µes SQL. Voc√™ define um delimitador com a palavra reservada <strong>DELIMITER</strong> e logo em seguida o delimitador que voc√™ quer. Aqui estou usando o <strong>$$</strong>.</p><p>Conte√∫do do arquivo: <strong>libs/create_table.bash</strong></p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="k">function </span>_create_table<span class="o">()</span> <span class="o">{</span>
  mysql <span class="nt">--host</span><span class="o">=</span><span class="nv">$HOST</span> <span class="nt">--port</span><span class="o">=</span><span class="nv">$PORT</span> <span class="nt">--user</span><span class="o">=</span><span class="nv">$USER</span> <span class="nt">--password</span><span class="o">=</span><span class="nv">$PASSWORD</span> <span class="o">&lt;&lt;</span> <span class="no">EOF</span><span class="sh">

  DELIMITER </span><span class="nv">$$</span><span class="sh">

  USE </span><span class="se">\`</span><span class="nv">$DB</span><span class="se">\`</span><span class="sh"> </span><span class="nv">$$</span><span class="sh">

  CREATE TABLE IF NOT EXISTS </span><span class="se">\`</span><span class="nv">$TABLE</span><span class="se">\`</span><span class="sh">  (
    id        INT(6) UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    title     VARCHAR(40) NOT NULL,
    did       INTEGER NOT NULL,
    date      TIMESTAMP,
    kind      VARCHAR(10),
    designer  VARCHAR(30),

  )</span><span class="nv">$$</span><span class="sh">
</span><span class="no">EOF
</span><span class="o">}</span></code></pre></figure><h2 id="criando-o-programa-principal-1">Criando o programa principal</h2><p>Vamos carregar todas nossas bibliotecas no <strong>setup.bash</strong> e o arquivo de configura√ß√£o <strong>config.conf</strong>. Na mesma ideia que fizemos no projeto do PostgreSQLm vamos fazer para o MySQL mais uma vez.</p><p>Conte√∫do do arquivo: <strong>setup.bash</strong></p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td><td class="code"><pre><span class="c">#!/usr/bin/env bash</span>

<span class="nb">source </span>config.conf

<span class="nv">libs</span><span class="o">=</span><span class="s2">"</span><span class="si">$(</span><span class="nb">ls</span> ./libs/<span class="k">*</span>.bash<span class="si">)</span><span class="s2">"</span>
<span class="k">for </span>lib <span class="k">in</span> <span class="nv">$libs</span><span class="p">;</span> <span class="k">do
  </span><span class="nb">source</span> <span class="nv">$lib</span>
<span class="k">done

case</span> <span class="nv">$1</span> <span class="k">in
  </span>createtb<span class="p">)</span>
    _create_database
    _create_table
  <span class="p">;;</span>
  <span class="k">*</span><span class="p">)</span>
    <span class="nb">printf</span> <span class="s2">"Using: </span><span class="nv">$0</span><span class="s2"> { createtb }"</span>
  <span class="p">;;</span>
<span class="k">esac</span>
<span class="nb">exit </span>0
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre></figure><h2 id="estrutura-do-projeto-para-mysql">Estrutura do projeto para MySQL</h2><p>A √°rvore do nosso projeto ficou assim:</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">.</span>
‚îú‚îÄ‚îÄ config.conf
‚îú‚îÄ‚îÄ libs
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ create_database.bash
‚îÇ¬†¬† ‚îî‚îÄ‚îÄ create_table.bash
‚îî‚îÄ‚îÄ setup.bash</code></pre></figure><h2 id="executando-nosso-programa-1">Executando nosso programa</h2><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">chmod</span> +x setup.bash
bash setup.bash createtb</code></pre></figure><p>Execute os comandos abaixo e verificar:</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">source </span>config.conf <span class="o">&amp;&amp;</span> mysql <span class="nt">--host</span><span class="o">=</span><span class="nv">$HOST</span> <span class="nt">--port</span><span class="o">=</span><span class="nv">$PORT</span> <span class="nt">--user</span><span class="o">=</span><span class="nv">$DB_USER</span> <span class="nt">--password</span><span class="o">=</span><span class="nv">$DB_PASSWD</span></code></pre></figure><p>Dentro do console do mysql, execute o comando abaixo para listar o DATABASE criado:</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash">MySQL <span class="o">[(</span>none<span class="o">)]&gt;</span> show databases<span class="p">;</span>
+--------------------+
| Database           |
+--------------------+
| information_schema |
| my_db              |
| mysql              |
| performance_schema |
+--------------------+
3 rows <span class="k">in </span><span class="nb">set</span> <span class="o">(</span>0.001 sec<span class="o">)</span></code></pre></figure><h1 id="conclus√£o">Conclus√£o</h1><p>Como dito, foi um simples post para voc√™ tenha uma no√ß√£o do que podemos fazer com Shell Script. Tanto os passos para PostgreSQL e para MySQL, existem trechos de c√≥digo praticamente id√™nticos, mudando uma coisinha ou outra. Por√©m, apesar de realizarmos transa√ß√µes no banco de dados com Shell Script, n√£o recomendo voc√™ tentar criar um sistema dessa maneira. Existem diversas linguagens de programa√ß√£o onde temos milhares de vantagens para realizar tudo que fizemos aqui.</p><p>Espero que voc√™ tenha aprendido algo com esse post. Eu fico por aqui, at√© a pr√≥xima.</p></div><div class="row post-tags"><ul class="tag-list"><strong>[<span class="spacer">tags</span>]:</strong><li class="tag-list__item"><a class="tag-list__link" href="/blog/tags/mysql">mysql</a></li><strong class="separator">;</strong><li class="tag-list__item"><a class="tag-list__link" href="/blog/tags/postgresql">postgresql</a></li><strong class="separator">;</strong><li class="tag-list__item"><a class="tag-list__link" href="/blog/tags/shell">shell</a></li><strong class="separator">;</strong></ul></div></div><div class="post-end text-center">////&nbsp;end of post&nbsp;////</div><div id="giscus" class="row comments"><h1 class="comments-title">[&nbsp;coment√°rios&nbsp;]</h1><div class="row comments-content"><script src="https://giscus.app/client.js" data-repo="williamcanin/williamcanin.github.io" data-repo-id="MDEwOlJlcG9zaXRvcnk0MDMyOTUzOQ==" data-repo-category="Comments" data-category-id="DIC_kwDOAmdhQ84CwLFu" data-mapping="pathname" data-strict="0" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="bottom" data-theme="noborder_light" data-lang="pt" crossorigin="anonymous" async></script></div></div><div class="row related-posts"><h3 class="related-posts-title">[&nbsp;postagens relacionadas&nbsp;]</h3><ul class="related-posts-list"><li class="related-posts-list__item"><span class="related-posts-list__meta">29 Abr, 2015</span>&nbsp;¬ª&nbsp;<a class="related-posts-list__link" href="/blog/arquivos-de-execucao-no-linux/">Arquivos de execu√ß√£o no Linux</a></li><li class="related-posts-list__item"><span class="related-posts-list__meta">03 Mar, 2015</span>&nbsp;¬ª&nbsp;<a class="related-posts-list__link" href="/blog/transacoes-com-procedures-no-mysql-e-heranca/">Transa√ß√µes com procedures no MySQL e Heran√ßa</a></li></ul></div></article></main></div><a id="top-link" href="#top" class="top-link" aria-label="back to top">‚á°</a><footer class="fixed-bottom footer"><div class="row footer-wrapper"><div class="col-md footer-copyright-wrap"><div class="footer-copyright">¬©&nbsp;William Canin&nbsp;2015-2026&nbsp;|&nbsp;<a href="/licenses/">Licen√ßas</a></div></div><div class="col-md footer-message-wrap"><div class="footer-message"><p>Simplicity is a feature, not a bug.</p></div></div><div class="col-md footer-made-by-wrap"><div class="footer-made-by">Using the <a href="https://rawfeed.github.io/rawfeed-jekyll" target="_blank" rel="noopener noreferrer">rawfeed</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener noreferrer">Jekyll</a>.</div></div></div></footer></div><script src="/assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script><script src="/assets/js/fallback/default.js"></script><script src="/assets/vendor/simple-jekyll-search.min.js"></script><script src="/assets/js/fallback/blog.js"></script><script src="/assets/js/fallback/home.js"></script><script src="/assets/js/fallback/page.js"></script><script src="/assets/js/fallback/contact.js"></script></body></html>