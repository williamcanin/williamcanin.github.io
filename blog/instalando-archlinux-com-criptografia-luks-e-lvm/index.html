<!DOCTYPE html><html id="top" lang="pt" data-theme="light"><head><meta name="viewport" content="width=device-width,initial-scale=1"><meta charset="utf-8"><title>Instalando Arch Linux com criptografia LUKS e LVM | Hey, I'm William Canin</title><script>if (window.top !== window.self) {
        // Prevents the site from being displayed inside an <iframe>
        window.top.location = window.self.location;
      }</script><meta http-equiv="Content-Security-Policy" content="
        default-src 'self';
        img-src 'self' data: https://www.google.com https://media0.giphy.com https://media4.giphy.com https://github.githubassets.com;
        script-src 'self' 'unsafe-inline'
        https://www.google.com
        https://www.gstatic.com
        https://cdn.jsdelivr.net
        https://cdnjs.cloudflare.com
        https://giscus.app
        https://disqus.com;
        style-src 'self' 'unsafe-inline'
        https://cdnjs.cloudflare.com
        https://fonts.googleapis.com
        https://cdn.jsdelivr.net
        https://giscus.app
        https://disqus.com;
        font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com data:;
        connect-src 'self' https://www.google.com https://api.github.com;
        frame-src https://www.google.com https://www.youtube.com https://giscus.app https://disqus.com;
        object-src 'none';
        base-uri 'self';
        form-action 'self';
    "><meta http-equiv="Strict-Transport-Security" content="max-age=31536000; includeSubDomains; preload"><meta http-equiv="Cross-Origin-Opener-Policy" content="same-origin"><meta http-equiv="Cross-Origin-Embedder-Policy" content="require-corp"><link rel="icon" type="image/png" href="/assets/images/favicon.png"><link rel="apple-touch-icon" href="/assets/images/favicon.png"><title>Instalando Arch Linux com criptografia LUKS e LVM | Hey, I‚Äôm William Canin</title><meta name="generator" content="Jekyll v4.4.1"><meta property="og:title" content="Instalando Arch Linux com criptografia LUKS e LVM"><meta name="author" content="William C. Canin"><meta property="og:locale" content="pt"><meta name="description" content="Este post, ir√° lhe informar como ter uma seguran√ßa forte para prote√ß√£o do seu S.O Arch Linux. Iae, quer estar protegido?!"><meta property="og:description" content="Este post, ir√° lhe informar como ter uma seguran√ßa forte para prote√ß√£o do seu S.O Arch Linux. Iae, quer estar protegido?!"><link rel="canonical" href="https://williamcanin.github.io/blog/instalando-archlinux-com-criptografia-luks-e-lvm/"><meta property="og:url" content="https://williamcanin.github.io/blog/instalando-archlinux-com-criptografia-luks-e-lvm/"><meta property="og:site_name" content="Hey, I‚Äôm William Canin"><meta property="og:type" content="article"><meta property="article:published_time" content="2017-04-27T14:33:43+00:00"><meta name="twitter:card" content="summary"><meta property="twitter:title" content="Instalando Arch Linux com criptografia LUKS e LVM"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"William C. Canin"},"dateModified":"2017-04-27T14:33:43+00:00","datePublished":"2017-04-27T14:33:43+00:00","description":"Este post, ir√° lhe informar como ter uma seguran√ßa forte para prote√ß√£o do seu S.O Arch Linux. Iae, quer estar protegido?!","headline":"Instalando Arch Linux com criptografia LUKS e LVM","mainEntityOfPage":{"@type":"WebPage","@id":"https://williamcanin.github.io/blog/instalando-archlinux-com-criptografia-luks-e-lvm/"},"url":"https://williamcanin.github.io/blog/instalando-archlinux-com-criptografia-luks-e-lvm/"}</script><meta property="og:locale:alternate" content="en_US"><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=SUSE+Mono:ital,wght@0,100..800;1,100..800&display=swap" rel="stylesheet"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inconsolata:400,700&amp;display=swap"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"><link rel="stylesheet" href="/assets/vendor/bootstrap/css/bootstrap.min.css"><script>(function() {
      const savedTheme = localStorage.getItem('theme') || 'light';
      document.documentElement.setAttribute('data-theme', savedTheme);
    })();</script><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="/assets/css/custom.css"><link rel="alternate" type="application/atom+xml" title="Hey, I'm William Canin
" href="/feed.xml"></head><body data-layout="post" data-terminal-enabled="true"><div class="default" style="max-width: 800px !important;"><div class="modal fade" id="avatarModal" tabindex="-1" aria-hidden="true"><div class="modal-dialog modal-dialog-centered"><div class="modal-content bg-transparent border-0 shadow-none"><div class="modal-body d-flex justify-content-center"><img id="modalAvatar" class="avatar-img" src="" alt=""></div></div></div></div><header class="container header"><div class="header-wrapper"><div class="row"><div class="col-sm-2 d-flex flex-column justify-content-end"><div class="container"><div class="row"><span>[&nbsp;üè†&nbsp;<a class="" href="/">home</a>&nbsp;]</span></div></div></div><div class="col-sm-8 d-flex flex-column justify-content-end"><div class="container"><div class="row"><span class="title">Hey, I'm William Canin</span></div><div class="row"><small class="description">thoughts on programming, digital wellbeing, linux</small></div></div></div><div class="col-sm-2 d-flex justify-content-end avatar"><div class="avatar-wrapper"><div class="avatar-flipper light-theme can-flip"><div class="avatar-card"><div class="avatar-front"><img id="avatarImgLight" class="avatar-img" src="/assets/images/wcanin_light.png" alt="Hey, I'm William Canin
"></div><div class="avatar-back"><img class="avatar-img" src="/assets/images/wcanin_back.png" alt="Hey, I'm William Canin
"></div></div></div><div class="avatar-flipper dark-theme can-flip"><div class="avatar-card"><div class="avatar-front"><img id="avatarImgDark" class="avatar-img" src="/assets/images/wcanin_dark.png" alt="Hey, I'm William Canin
"></div><div class="avatar-back"><img class="avatar-img" src="/assets/images/wcanin_back.png" alt="Hey, I'm William Canin
"></div></div></div></div></div></div><div class="menu-separator"></div><div class="row"><div class="col-sm d-flex justify-content-center column-bottom"><span class="blog-menu">weblog&nbsp;¬ª <a class="blog-menu__link" href="/blog/">üìù&nbsp;posts</a><strong>&nbsp;.&nbsp;</strong>üîç&nbsp;<a id="blog-search__btn" class="blog-menu__link" href="/blog/?search=open">search</a><strong>&nbsp;.&nbsp;</strong>üè∑Ô∏è&nbsp;<a class="blog-menu__link" href="/blog/tags/">tags</a><strong>&nbsp;.&nbsp;</strong>üì∞&nbsp;<a class="blog-menu__link" href="/feed.xml">feed</a><strong>&nbsp;.&nbsp;</strong></span></div></div><div class="row justify-content-end"><div class="col-sm-2 d-flex justify-content-end"><span id="toggle-theme"><i class="fa-solid fa-moon"></i></span></div></div></div></header><main class="content"><article class="container post" itemscope itemtype="http://schema.org/BlogPosting"><div class="row"><header class="post-header"><h1 class="post-title p-name" itemprop="name headline">¬ª&nbsp;Instalando Arch Linux com criptografia LUKS e LVM</h1><div class="row post-meta"><div class="col-sm d-flex justify-content-start"><time class="dt-published" datetime="2017-04-27T14:33:43+00:00" itemprop="datePublished">27 Abr, 2017</time></div><div class="col-sm d-flex justify-content-end"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">autor:&nbsp;William C. Canin</span></span></div><div class="post-reading_time">[&nbsp;Leia em cerca de 47 minutos&nbsp;]</div></div></header><div class="post-content e-content" itemprop="articleBody"><nav class="toc" id="toc" data-toc-selector=".post-content" data-toc-max-level="3" data-toc-scroll-offset="20"><div class="toc-head"><h2>√çndice</h2><button class="toc-toggle" aria-expanded="true" type="button">Fechar</button></div><div class="toc-list-wrapper"><ul class="toc-list" role="list"></ul><p class="toc-empty" style="display:none">No titles found. Remove TOC!</p></div></nav><script>(function () {
  const minLayoutWidth = 1830;

  const toc = document.getElementById('toc');
  if (toc) {
    const sentinel = document.createElement('div');
    toc.parentNode.insertBefore(sentinel, toc);

    function shouldApplyFixed() {
      return window.innerWidth > minLayoutWidth;
    }

    const observer = new IntersectionObserver(
      ([entry]) => {
        if (shouldApplyFixed()) {
          if (!entry.isIntersecting) {
            toc.classList.add('toc-fixed');
          } else {
            toc.classList.remove('toc-fixed');
          }
        } else {
          toc.classList.remove('toc-fixed');
        }
      },
      { threshold: 0 }
    );
    observer.observe(sentinel);

    window.addEventListener('resize', () => {
        if (!shouldApplyFixed()) {
            toc.classList.remove('toc-fixed');
        }
    });
  }

  function slugify(text) {
    if (!text) return '';
    return text.toString().toLowerCase().trim()
      .normalize('NFKD').replace(/[\u0300-\u036f]/g, '')
      .replace(/[^\w\s-]/g, '').replace(/\s+/g, '-').replace(/--+/g, '-');
  }

  function buildTOC(tocEl) {
    const selector = tocEl.dataset.tocSelector || '.post-content' || '.page-content';
    const maxLevel = parseInt(tocEl.dataset.tocMaxLevel || '3', 10);
    const offset = parseInt(tocEl.dataset.tocScrollOffset || '20', 10);
    const root = document.querySelector(selector);

    if (!root) {
      tocEl.querySelector('.toc-empty').textContent = `Content not found (${selector})`;
      tocEl.querySelector('.toc-empty').style.display = 'block';
      return;
    }

    const headings = Array.from(root.querySelectorAll(Array(maxLevel).fill(0).map((_, i) => `h${i + 1}`).join(',')))
      .filter(h => !tocEl.contains(h))
      .filter(h => parseInt(h.tagName.substring(1)) <= maxLevel);

    if (headings.length === 0) {
      tocEl.querySelector('.toc-empty').style.display = 'block';
      return;
    }

    const tocRoot = tocEl.querySelector('.toc-list');
    tocRoot.innerHTML = '';

    const idCounts = {};
    headings.forEach(h => {
      if (!h.id) {
        let id = slugify(h.textContent);
        if (!id) id = 'section';
        if (idCounts[id]) { idCounts[id] += 1; id = id + '-' + idCounts[id]; }
        else idCounts[id] = 1;
        h.id = id;
      }
    });

    // Build hierarchical tree
    const stack = [{ level: 0, ul: tocRoot }];
    headings.forEach((h, i) => {
      const level = parseInt(h.tagName.substring(1));
      const li = document.createElement('li');
      const a = document.createElement('a');
      a.href = '#' + h.id;
      a.textContent = h.textContent.trim();
      a.addEventListener('click', e => {
        e.preventDefault();
        window.scrollTo({ top: h.getBoundingClientRect().top + window.scrollY - offset, behavior: 'smooth' });
        history.replaceState(null, '', '#' + h.id);

        // // Clicking on the TOC menu closes the TOC
        // const wrapper = tocEl.querySelector('.toc-list-wrapper');
        // const toggle = tocEl.querySelector('.toc-toggle');
        // wrapper.style.display = 'none';
        // toggle.setAttribute('aria-expanded', 'false');
        // toggle.textContent = '{ { include.btn_show } }';
      });
      li.appendChild(a);

      while (stack.length > 1 && level <= stack[stack.length - 1].level) stack.pop();
      const parent = stack[stack.length - 1].ul;
      parent.appendChild(li);

      const next = headings[i + 1];
      if (next) {
        const nextLevel = parseInt(next.tagName.substring(1));
        if (nextLevel > level) {
          const newUl = document.createElement('ul');
          li.appendChild(newUl);
          stack.push({ level, ul: newUl });
        }
      }
    });

    // Active Highlight
    const links = tocRoot.querySelectorAll('a');
    function onScroll() {
      const fromTop = window.scrollY + offset + 1;
      let current = headings[0];
      for (let i = 0; i < headings.length; i++) {
        if (headings[i].offsetTop <= fromTop) current = headings[i];
      }
      links.forEach(l => l.classList.toggle('active', l.getAttribute('href') === '#' + current.id));
    }
    window.addEventListener('scroll', onScroll, { passive: true });
    onScroll();
  }

  document.addEventListener('DOMContentLoaded', function () {
    document.querySelectorAll('.toc').forEach(toc => {
      buildTOC(toc);
      const toggle = toc.querySelector('.toc-toggle');
      const wrapper = toc.querySelector('.toc-list-wrapper');

      wrapper.style.display = 'none';
      toggle.setAttribute('aria-expanded', 'false');
      toggle.textContent = 'Abrir';

      toggle.addEventListener('click', () => {
        const expanded = toggle.getAttribute('aria-expanded') === 'true';
        wrapper.style.display = expanded ? 'none' : 'block';
        toggle.setAttribute('aria-expanded', (!expanded).toString());
        toggle.textContent = expanded ? 'Abrir' : 'Fechar';
      });

      const tocTop = toc.offsetTop;

      function handleScrollFix() {
        if (window.innerWidth <= minLayoutWidth) {
          toc.classList.remove('fixed');
          toc.style.position = '';
          toc.style.top = '';
          toc.style.zIndex = '';
          toc.style.width = '';
          return;
        }

        const scrollTop = window.scrollY || document.documentElement.scrollTop;

        // Fixes pinning behavior in Chrome
        if (scrollTop >= tocTop) {
          toc.classList.add('fixed');
          toc.style.position = 'fixed';
          toc.style.top = '0';
          toc.style.zIndex = '9999';
          // toc.style.width = toc.offsetWidth + 'px';
        } else {
          toc.classList.remove('fixed');
          toc.style.position = '';
          toc.style.top = '';
          toc.style.width = '';
        }

        // // Automatically closes the TOC if it is open and scrolled to it.
        // const rect = toc.getBoundingClientRect();
        // if (rect.top <= 0 && toggle.getAttribute('aria-expanded') === 'true') {
        //   wrapper.style.display = 'none';
        //   toggle.setAttribute('aria-expanded', 'false');
        //   toggle.textContent = '{ { include.btn_show } }';
        // }
      }

      window.addEventListener('scroll', handleScrollFix, { passive: true });
      window.addEventListener('resize', handleScrollFix);
      handleScrollFix();
    });
  });
})();</script><p>Ei, beleza? üëç</p><p>Este √© o guia que fiz, e uso atualmente para instalar o <a href="https://archlinux.org/">Arch Linux</a> em minha m√°quina.</p><p>Este guia ir√° ter detalhes e coment√°rios RESUMIDO de cada comando, caso queira um guia com apenas os comandos, sem muita ‚Äúverbosidade‚Äù de coment√°rios, use este outro guia que fiz em modo <code class="language-plaintext highlighter-rouge">.txt</code>: <a href="/docs/raw/archlinux_installation.txt">archlinux_installation.txt</a>.</p><blockquote><p>NOTA: Nesses guias, talvez nem tudo sirva para seu gosto e/ou suporte de sua m√°quina, ent√£o se for usar algo, tenha consci√™ncia se √© compat√≠vel com seu setup. N√£o me responsabilizo por qualquer dano que sua m√°quina venha sofrer.</p></blockquote><h1 id="prepara√ß√£o-de-flash-drive">Prepara√ß√£o de Flash Drive</h1><p>Baixo a imagem do Arch Linux em <a href="https://archlinux.org/download/">Arch Linux Download</a>. Eu uso o BitTorrent para evitar corromper a imagem durante o download, e para gravar a imagem, se eu estiver no Linux, uso <code class="language-plaintext highlighter-rouge">dd</code> com o comando abaixo:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">dd </span><span class="nv">bs</span><span class="o">=</span>4M <span class="k">if</span><span class="o">=</span>archlinux-&lt;VERSION&gt;-x86_64.iso <span class="nv">of</span><span class="o">=</span>/dev/sdX <span class="nv">conv</span><span class="o">=</span>fsync <span class="nv">oflag</span><span class="o">=</span>direct <span class="nv">status</span><span class="o">=</span>progress
</code></pre></div></div><blockquote><p>Nota: Substitua o sdX pelo flash drive real.</p></blockquote><h1 id="iniciando-a-instala√ß√£o">Iniciando a instala√ß√£o</h1><p>Quando j√° estou dentro da ISO do <strong>Arch Linux</strong>, sigo esses passos:</p><h1 id="layout">Layout</h1><p>Atribuo layout do teclado para <code class="language-plaintext highlighter-rouge">br-abnt2</code>, que √© o que eu uso:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>loadkeys br-abnt2
</code></pre></div></div><h1 id="conex√£o-com-a-internet">Conex√£o com a internet</h1><p><strong>Via Cabo:</strong></p><p>Apenas conecto o cabo de rede e j√° tenho internet na ISO do <strong>Arch Linux</strong>.</p><div class="details-start" data-summary="Via Wi-Fi"></div><script>(function(){
  if (window.__jekyll_details_setup) return;
  window.__jekyll_details_setup = true;

  function initDetails(){
    const starts = document.querySelectorAll('.details-start');
    starts.forEach(start => {
      const summary = start.getAttribute('data-summary') || 'Detalhes';

      let end = start.nextSibling;
      while(end && !(end.nodeType === 1 && end.classList.contains('details-end'))){
        end = end.nextSibling;
      }
      if(!end) return;

      let node = start.nextSibling;
      const content = [];
      while(node && node !== end){
        const next = node.nextSibling;
        if(node.nodeType === Node.ELEMENT_NODE || (node.nodeType === Node.TEXT_NODE && node.textContent.trim())){
          content.push(node.cloneNode(true));
        }
        node = next;
      }

      const details = document.createElement('details');
      const sum = document.createElement('summary');
      sum.textContent = summary;
      details.appendChild(sum);

      const wrapper = document.createElement('div');
      wrapper.className = 'details-content-wrapper';

      content.forEach(el => wrapper.appendChild(el));

      details.appendChild(wrapper);

      start.parentNode.insertBefore(details, start);
      let cur = start;
      while(cur){
        const next = cur.nextSibling;
        cur.remove();
        if(cur === end) break;
        cur = next;
      }
    });
  }

  if(document.readyState === 'loading')
    document.addEventListener('DOMContentLoaded', initDetails);
  else
    initDetails();
})();</script><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>systemctl start iwd<span class="p">;</span>
iwctl
</code></pre></div></div><p>Quando entrar dentro do <code class="language-plaintext highlighter-rouge">[iwd]#</code>, os passos de comandos que uso ser√£o esses basicamente:</p><figure class="highlight"><pre><code class="language-shell" data-lang="shell"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="code"><pre>device list
device &lt;NAME&gt; set-property Powered on
adapter set-property Powered on
station list
station &lt;IFACE_NAME&gt; scan
station &lt;IFACE_NAME&gt; get-networks
station &lt;IFACE_NAME&gt; connect <span class="s1">'&lt;NETWORK_NAME&gt;'</span>
Passphrase:
quit
</pre></td></tr></tbody></table></code></pre></figure><div class="details-end"></div><blockquote><p>NOTA: Ap√≥s configurar a internet, fa√ßo um <code class="language-plaintext highlighter-rouge">ping 8.8.8.8</code> para verificar.</p></blockquote><h1 id="conex√£o-ssh">Conex√£o SSH</h1><p>Geralmente fa√ßo a instala√ß√£o do <strong>Arch Linux</strong> na minha m√°quina via SSH, ou seja, de outra m√°quina, assim eu consigo abrir este guia e apenas copiar e colar os comandos do que ficar digitando cada comando.</p><p><strong>(1)</strong> - Para habilitar o SSH na ISO do <strong>Arch Linux</strong> √© simples, a ISO j√° vem com o SSH instalado, ent√£o basta ativar:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>systemct start sshd
</code></pre></div></div><p><strong>(2)</strong> - Ap√≥s isso crio a senha do root da imagem ISO para poder fazer a conex√£o SSH:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>passwd
</code></pre></div></div><p><strong>(3)</strong> - Agora na outra m√°quina apenas me conecto:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ssh root@192.168.X.XX
</code></pre></div></div><h1 id="particionamento">Particionamento</h1><p>Aqui √© a parte MAIS DELICADA, tenho o M√ÅXIMO de aten√ß√£o para n√£o escolher a unidade errada. hehe üòÅ</p><p>N√£o vou colocar comandos de como realizar o particionamento, apenas relatar algumas informa√ß√µes IMPORTANTES e o esbo√ßo (tabela) de como o particionamento para a instala√ß√£o do <strong>Arch Linux</strong> fica em minha m√°quina.</p><h2 id="tabela">Tabela</h2><table><thead><tr><th>Dispositivo</th><th>Tamanho</th><th>Tipo</th><th>Local</th></tr></thead><tbody><tr><td>/dev/sda1</td><td>1,5G</td><td>Sistema EFI</td><td>/boot</td></tr><tr><td>/dev/sda2</td><td>120G</td><td>Linux LVM</td><td>¬†</td></tr><tr><td>/dev/sdb1</td><td>1T</td><td>Linux filesystems</td><td>/home</td></tr></tbody></table><div class="details-start" data-summary="&gt;&gt;&gt; Informa√ß√µes interessantes ü§î"></div><script>(function(){
  if (window.__jekyll_details_setup) return;
  window.__jekyll_details_setup = true;

  function initDetails(){
    const starts = document.querySelectorAll('.details-start');
    starts.forEach(start => {
      const summary = start.getAttribute('data-summary') || 'Detalhes';

      let end = start.nextSibling;
      while(end && !(end.nodeType === 1 && end.classList.contains('details-end'))){
        end = end.nextSibling;
      }
      if(!end) return;

      let node = start.nextSibling;
      const content = [];
      while(node && node !== end){
        const next = node.nextSibling;
        if(node.nodeType === Node.ELEMENT_NODE || (node.nodeType === Node.TEXT_NODE && node.textContent.trim())){
          content.push(node.cloneNode(true));
        }
        node = next;
      }

      const details = document.createElement('details');
      const sum = document.createElement('summary');
      sum.textContent = summary;
      details.appendChild(sum);

      const wrapper = document.createElement('div');
      wrapper.className = 'details-content-wrapper';

      content.forEach(el => wrapper.appendChild(el));

      details.appendChild(wrapper);

      start.parentNode.insertBefore(details, start);
      let cur = start;
      while(cur){
        const next = cur.nextSibling;
        cur.remove();
        if(cur === end) break;
        cur = next;
      }
    });
  }

  if(document.readyState === 'loading')
    document.addEventListener('DOMContentLoaded', initDetails);
  else
    initDetails();
})();</script><h2 id="boot">Boot</h2><p>O <strong>Arch Linux</strong> precisa apenas de uma parti√ß√£o de boot, a <code class="language-plaintext highlighter-rouge">/boot</code> do tipo <strong>EFI System</strong>, MAS, quando quero fazer um dual-boot com outras distros, que necessita de duas parti√ß√µes de boot separadas, uma <code class="language-plaintext highlighter-rouge">/boot</code> do tipo <strong>Linux filesystems</strong> e outra <code class="language-plaintext highlighter-rouge">/boot/efi</code> do tipo <strong>EFI System</strong>, por exemplo, <strong>Fedora 42</strong>, e eu queira COMPARTILHAR o bootloader, no caso o <strong>systemd-boot</strong> (que eu uso) entre ambas, ent√£o instalo o <strong>Arch Linux</strong> com a parti√ß√£o de boot separada em duas tamb√©m.</p><p>Toda vez que o <strong>Arch Linux</strong> gera o ‚Äú<strong>vmlinuz-linux-lts</strong>‚Äù e ‚Äú<strong>initramfs-linux-lts.img</strong>‚Äù por exemplo, ele gera no diret√≥rio <code class="language-plaintext highlighter-rouge">/boot</code>, isso porque a configura√ß√£o padr√£o √© para este diret√≥rio, mas com a EFI apontando para <code class="language-plaintext highlighter-rouge">/boot/efi</code>, tive que modificar essa configura√ß√£o no arquivo <code class="language-plaintext highlighter-rouge">/etc/mkinitcpio.d/linux-lts.preset</code> (kernel LTS) e reinstalar o kernel. Na se√ß√£o de <strong>Instalando o bootloader systemd-boot</strong>, ter√° mais informa√ß√µes sobre essa modifica√ß√£o.</p><ul><li>Sabendo disso, nesses guias N√ÉO VOU USAR duas parti√ß√£o de boot separadas porque n√£o uso mais dual-boot e nem compartilhamento do <strong>systemd-boot</strong> com outros sistemas, por√©m, eu vou relatar cada passo que precisa fazer em uma instala√ß√£o com <code class="language-plaintext highlighter-rouge">/boot</code> e <code class="language-plaintext highlighter-rouge">/boot/efi</code> caso eu precise futuramente.</li></ul><h2 id="sistema">Sistema</h2><p>Instalo o <strong>Arch Linux</strong> em um SSD de <strong>250 Gigabytes</strong> (<em>250Gb</em>), mas eu apenas deixo <strong>120Gb</strong>, n√£o uso mais que isso para o sistema <strong>Arch Linux</strong>. Atualmente estou usando o sistema de arquivo <code class="language-plaintext highlighter-rouge">ext4</code>.</p><h2 id="home">Home</h2><p>Tenho um SSD de <strong>1 Terabyte</strong> (<em>1Tb</em>) para minha <code class="language-plaintext highlighter-rouge">/home</code>, e criptografo a mesma usando o LUKS (<em>dm-crypt</em>), com o sistema de arquivos <code class="language-plaintext highlighter-rouge">ext4</code>.</p><h2 id="tabela-1">Tabela</h2><p>Tabela com a parti√ß√£o de boot separada em duas deve ficar assim:</p><table><thead><tr><th>Dispositivo</th><th>Tamanho</th><th>Tipo</th><th>Local</th></tr></thead><tbody><tr><td>/dev/sda1</td><td>2G</td><td>Linux filesystems</td><td>/boot</td></tr><tr><td>/dev/sda2</td><td>2G</td><td>EFI System</td><td>/boot/efi</td></tr><tr><td>/dev/sda3</td><td>120G</td><td>Linux LVM</td><td>¬†</td></tr><tr><td>/dev/sdb1</td><td>1T</td><td>Linux filesystems</td><td>/home</td></tr></tbody></table><div class="details-end"></div><p>Para realizar o particionamento, geralmente eu uso o <code class="language-plaintext highlighter-rouge">cfdisk</code>:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cfdisk /dev/sdX
</code></pre></div></div><blockquote><p>Nota: Substituo o sdX pelo dispositivo real, <code class="language-plaintext highlighter-rouge">/dev/sda</code> e <code class="language-plaintext highlighter-rouge">/dev/sdb</code>.</p></blockquote><h1 id="criando-estrutura-lvm-para-o-sistema">Criando estrutura LVM para o sistema</h1><p>No <strong>LVM</strong>, precisa criar um <strong>Volume F√≠sico</strong> (PV), <strong>Grupo</strong> (VG), e um <strong>Volume L√≥gico</strong> (LV), onde o grupo vai fazer parte de um volume f√≠sico, e o volume l√≥gico vai estar dentro de um grupo.</p><p>Gosto de usar <strong>LVM</strong> para ter controle sobre minhas parti√ß√µes, caso eu queira aumentar ou diminuir sem ter problema de corromper dados. Para isso, os comando que uso s√£o simples:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pvcreate /dev/sda3<span class="p">;</span>
vgcreate linux /dev/sda3<span class="p">;</span>
lvcreate <span class="nt">-L</span> 120G linux <span class="nt">-n</span> <span class="nb">arch</span><span class="p">;</span>
</code></pre></div></div><blockquote><p>NOTA: No segundo comando, o nome <code class="language-plaintext highlighter-rouge">linux</code> √© o nome do grupo que defino (pode ser qualquer nome), no terceiro comando, crio um volume l√≥gico especificando o grupo (<code class="language-plaintext highlighter-rouge">linux</code>).</p></blockquote><h1 id="criando-e-criptografando-a-unidade-home">Criando e criptografando a unidade /home</h1><p><strong>(1)</strong> - Criptografando a unidade <code class="language-plaintext highlighter-rouge">/dev/sdb1</code>:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cryptsetup <span class="nt">-y</span> <span class="nt">-v</span> luksFormat /dev/sdb1
</code></pre></div></div><blockquote><p>IMPORTANTE!!! Se tenho uma unidade <code class="language-plaintext highlighter-rouge">/dev/mapper/home</code> criptografada com meus arquivos, ent√£o n√£o fa√ßo o passo <strong>1</strong>, sen√£o irei perder meus dados/arquivos. PULO para o passo <strong>2</strong>.</p></blockquote><p><strong>(2)</strong> - Criando/abrindo a unidade criptografada:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cryptsetup open /dev/sdb1 home
</code></pre></div></div><h1 id="formata√ß√£o">Formata√ß√£o</h1><p>Agora formato cada unidade que foi criada:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkfs.fat <span class="nt">-F</span> 32 /dev/sda1<span class="p">;</span>
mkfs <span class="nt">-t</span> ext4 /dev/mapper/linux-arch<span class="p">;</span>
mkfs <span class="nt">-t</span> ext4 /dev/mapper/home<span class="p">;</span>
</code></pre></div></div><div class="details-start" data-summary="Com parti√ß√£o de boot separada"></div><script>(function(){
  if (window.__jekyll_details_setup) return;
  window.__jekyll_details_setup = true;

  function initDetails(){
    const starts = document.querySelectorAll('.details-start');
    starts.forEach(start => {
      const summary = start.getAttribute('data-summary') || 'Detalhes';

      let end = start.nextSibling;
      while(end && !(end.nodeType === 1 && end.classList.contains('details-end'))){
        end = end.nextSibling;
      }
      if(!end) return;

      let node = start.nextSibling;
      const content = [];
      while(node && node !== end){
        const next = node.nextSibling;
        if(node.nodeType === Node.ELEMENT_NODE || (node.nodeType === Node.TEXT_NODE && node.textContent.trim())){
          content.push(node.cloneNode(true));
        }
        node = next;
      }

      const details = document.createElement('details');
      const sum = document.createElement('summary');
      sum.textContent = summary;
      details.appendChild(sum);

      const wrapper = document.createElement('div');
      wrapper.className = 'details-content-wrapper';

      content.forEach(el => wrapper.appendChild(el));

      details.appendChild(wrapper);

      start.parentNode.insertBefore(details, start);
      let cur = start;
      while(cur){
        const next = cur.nextSibling;
        cur.remove();
        if(cur === end) break;
        cur = next;
      }
    });
  }

  if(document.readyState === 'loading')
    document.addEventListener('DOMContentLoaded', initDetails);
  else
    initDetails();
})();</script><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkfs <span class="nt">-t</span> ext4 /dev/sda1<span class="p">;</span>
mkfs.fat <span class="nt">-F</span> 32 /dev/sda2<span class="p">;</span>
mkfs <span class="nt">-t</span> ext4 /dev/mapper/linux-arch<span class="p">;</span>
mkfs <span class="nt">-t</span> ext4 /dev/mapper/home<span class="p">;</span>
</code></pre></div></div><div class="details-end"></div><blockquote><p>IMPORTANTE!!! Se tenho a parti√ß√£o <code class="language-plaintext highlighter-rouge">/dev/mapper/home</code> com arquivos, n√£o formato sen√£o irei perder TODOS meus dados/arquivos.</p></blockquote><p>Depois de todas unidades estarem criadas e formatadas, gosto de verificar com o comando: <code class="language-plaintext highlighter-rouge">lsblk -f</code>:</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="code"><pre>NAME        FSTYPE      FSVER     LABEL     UUID                                   FSAVAIL FSUSE% MOUNTPOINTS
sda
‚îú‚îÄsda1      vfat        FAT32               BA60-4D21                                 1,5G    12% /boot
‚îî‚îÄsda2      LVM2_member LVM2 001            8YUXnI-FwmY-Vc8V-fUHy-cVdF-zi9X-MDAK0s
  ‚îî‚îÄ‚îÄlinux-arch
           ext4        1.0                  0a73a608-5260-45c8-9bdd-8285c4a4a84b     89,8G    44% /
sdb
‚îî‚îÄsdb1      crypto_LUKS 2                   a4fd06b1-a253-4661-b5a2-47ae92e68efe
  ‚îî‚îÄhome    ext4        1.0                 65660251-8451-4722-adbd-ff5850c5df6d    999,7G    37% /home
</pre></td></tr></tbody></table></code></pre></figure><div class="details-start" data-summary="Com parti√ß√£o de boot separada"></div><script>(function(){
  if (window.__jekyll_details_setup) return;
  window.__jekyll_details_setup = true;

  function initDetails(){
    const starts = document.querySelectorAll('.details-start');
    starts.forEach(start => {
      const summary = start.getAttribute('data-summary') || 'Detalhes';

      let end = start.nextSibling;
      while(end && !(end.nodeType === 1 && end.classList.contains('details-end'))){
        end = end.nextSibling;
      }
      if(!end) return;

      let node = start.nextSibling;
      const content = [];
      while(node && node !== end){
        const next = node.nextSibling;
        if(node.nodeType === Node.ELEMENT_NODE || (node.nodeType === Node.TEXT_NODE && node.textContent.trim())){
          content.push(node.cloneNode(true));
        }
        node = next;
      }

      const details = document.createElement('details');
      const sum = document.createElement('summary');
      sum.textContent = summary;
      details.appendChild(sum);

      const wrapper = document.createElement('div');
      wrapper.className = 'details-content-wrapper';

      content.forEach(el => wrapper.appendChild(el));

      details.appendChild(wrapper);

      start.parentNode.insertBefore(details, start);
      let cur = start;
      while(cur){
        const next = cur.nextSibling;
        cur.remove();
        if(cur === end) break;
        cur = next;
      }
    });
  }

  if(document.readyState === 'loading')
    document.addEventListener('DOMContentLoaded', initDetails);
  else
    initDetails();
})();</script><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="code"><pre>NAME        FSTYPE      FSVER     LABEL     UUID                                   FSAVAIL FSUSE% MOUNTPOINTS
sda
‚îú‚îÄsda1      ext4        1.0                 69660251-8451-4322-cdbd-ff5850c5df6d      1,5G    12% /boot
‚îú‚îÄsda2      vfat        FAT32               BA60-4D21                                 1,5G    12% /boot
‚îî‚îÄsda3      LVM2_member LVM2 001            8YUXnI-FwmY-Vc8V-fUHy-cVdF-zi9X-MDAK0s
  ‚îî‚îÄ‚îÄlinux-arch
           ext4        1.0                  0a73a608-5260-45c8-9bdd-8285c4a4a84b     89,8G    44% /
sdb
‚îî‚îÄsdb1      crypto_LUKS 2                   a4fd06b1-a253-4661-b5a2-47ae92e68efe
  ‚îî‚îÄhome    ext4        1.0                 65660251-8451-4722-adbd-ff5850c5df6d    999,7G    37% /home
</pre></td></tr></tbody></table></code></pre></figure><div class="details-end"></div><h1 id="montagem-das-unidades">Montagem das unidades</h1><p>Tudo em ordem, agora fa√ßo o <code class="language-plaintext highlighter-rouge">mount</code> das unidades:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mount /dev/mapper/linux-arch /mnt<span class="p">;</span>
mount <span class="nt">--mkdir</span> /dev/sda1 /mnt/boot<span class="p">;</span>
mount <span class="nt">--mkdir</span> /dev/mapper/home /mnt/home<span class="p">;</span>
</code></pre></div></div><div class="details-start" data-summary="Com parti√ß√£o de boot separada"></div><script>(function(){
  if (window.__jekyll_details_setup) return;
  window.__jekyll_details_setup = true;

  function initDetails(){
    const starts = document.querySelectorAll('.details-start');
    starts.forEach(start => {
      const summary = start.getAttribute('data-summary') || 'Detalhes';

      let end = start.nextSibling;
      while(end && !(end.nodeType === 1 && end.classList.contains('details-end'))){
        end = end.nextSibling;
      }
      if(!end) return;

      let node = start.nextSibling;
      const content = [];
      while(node && node !== end){
        const next = node.nextSibling;
        if(node.nodeType === Node.ELEMENT_NODE || (node.nodeType === Node.TEXT_NODE && node.textContent.trim())){
          content.push(node.cloneNode(true));
        }
        node = next;
      }

      const details = document.createElement('details');
      const sum = document.createElement('summary');
      sum.textContent = summary;
      details.appendChild(sum);

      const wrapper = document.createElement('div');
      wrapper.className = 'details-content-wrapper';

      content.forEach(el => wrapper.appendChild(el));

      details.appendChild(wrapper);

      start.parentNode.insertBefore(details, start);
      let cur = start;
      while(cur){
        const next = cur.nextSibling;
        cur.remove();
        if(cur === end) break;
        cur = next;
      }
    });
  }

  if(document.readyState === 'loading')
    document.addEventListener('DOMContentLoaded', initDetails);
  else
    initDetails();
})();</script><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mount /dev/mapper/linux-arch /mnt<span class="p">;</span>
mount <span class="nt">--mkdir</span> /dev/sda1 /mnt/boot<span class="p">;</span>
mount <span class="nt">--mkdir</span> /dev/sda2 /mnt/boot/efi<span class="p">;</span>
mount <span class="nt">--mkdir</span> /dev/mapper/home /mnt/home<span class="p">;</span>
</code></pre></div></div><div class="details-end"></div><h1 id="instalando-o-sistema-base-do-arch-linux">Instalando o sistema base do Arch Linux</h1><p>Aqui eu atualizo os <code class="language-plaintext highlighter-rouge">mirrorlist</code> para o <code class="language-plaintext highlighter-rouge">Brazil</code> e <code class="language-plaintext highlighter-rouge">US</code> usando <code class="language-plaintext highlighter-rouge">reflector</code> j√° dispon√≠vel na ISO do <strong>Arch Linux</strong>, e logo em seguida atualizo as chaves e o cache, para depois fazer instala√ß√£o do sistema base com o kernel LTS, e alguns pacotes que acho essenciais durante a instala√ß√£o.</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="code"><pre>reflector <span class="nt">--verbose</span> <span class="nt">--country</span> Brazil,US <span class="nt">--age</span> 12 <span class="nt">--protocol</span> https <span class="nt">--sort</span> rate <span class="nt">--save</span> /etc/pacman.d/mirrorlist<span class="p">;</span>
pacman <span class="nt">-Syy</span><span class="p">;</span>
pacman <span class="nt">-Sy</span> archlinux-keyring<span class="p">;</span>
pacman-key <span class="nt">--populate</span> archlinux<span class="p">;</span>
pacstrap <span class="nt">-K</span> /mnt base base-devel linux-lts linux-lts-headers linux-firmware systemd systemd-ukify <span class="nb">sudo </span>vim dhcpcd wireless_tools wpa_supplicant<span class="p">;</span>
</pre></td></tr></tbody></table></code></pre></figure><h1 id="gerando-o-etcfstab">Gerando o /etc/fstab</h1><p>Aqui n√£o tenho muito o que dizer, apenas gero o <code class="language-plaintext highlighter-rouge">/etc/fstab</code> para que todas minhas parti√ß√µes montadas sejam configuradas durando o boot da m√°quina.</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>genfstab <span class="nt">-U</span> <span class="nt">-p</span> /mnt <span class="o">&gt;&gt;</span> /mnt/etc/fstab
</code></pre></div></div><h1 id="entrando-no-sistema-pr√©-instalado">Entrando no sistema pr√©-instalado</h1><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>arch-chroot /mnt /bin/bash
</code></pre></div></div><h1 id="atribuindo-senha-de-root">Atribuindo senha de <code class="language-plaintext highlighter-rouge">root</code></h1><p>A primeira coisa que gosto de fazer √© atribuir uma senha para o usu√°rio <code class="language-plaintext highlighter-rouge">root</code>:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>passwd
</code></pre></div></div><h1 id="configurando-internet">Configurando internet</h1><p>Como atualmente uso uma conex√£o via cabo, n√£o tenho necessidade de usar o <code class="language-plaintext highlighter-rouge">NetworkManager</code> como gerenciador de conex√£o com internet para ficar me dando v√°rias configura√ß√µes que n√£o uso.</p><p>Eu apenas quero me conectar e pronto. Acho ele um pouco desnecess√°rio em consumo de mem√≥ria pra uma finalidade muito espec√≠fica.</p><p>Ent√£o, eu uso o <code class="language-plaintext highlighter-rouge">systemd-networkd</code> que √© mais leve e objetivo.</p><p><strong>(1)</strong> - Caso eu j√° tenho o <code class="language-plaintext highlighter-rouge">NetworkManager</code> instalado, eu apenas desabilito e fa√ßo o <code class="language-plaintext highlighter-rouge">mask</code>:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>systemctl disable <span class="nt">--now</span> NetworkManager.service<span class="p">;</span>
systemctl mask NetworkManager.service<span class="p">;</span>
</code></pre></div></div><p><strong>(2)</strong> - Depois habilito o <code class="language-plaintext highlighter-rouge">systemd-networkd</code> e <code class="language-plaintext highlighter-rouge">systemd-resolved</code>:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>systemctl <span class="nb">enable</span> <span class="nt">--now</span> systemd-networkd.service systemd-resolved.service
</code></pre></div></div><p><strong>(3)</strong> - Abro o arquivo de configura√ß√£o do <code class="language-plaintext highlighter-rouge">systemd-networkd</code> e coloco o seguinte:</p><figure class="highlight"><pre><code class="language-conf" data-lang="conf"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="code"><pre>[<span class="n">Match</span>]
<span class="n">Name</span>=<span class="n">eno1</span> <span class="c"># Nome da minha interface de rede
</span>
<span class="c">## Conex√£o com IP Est√°tico
</span>[<span class="n">Network</span>]
<span class="n">Address</span>=<span class="m">192</span>.<span class="m">168</span>.<span class="m">0</span>.<span class="m">2</span>/<span class="m">24</span>
<span class="n">Gateway</span>=<span class="m">192</span>.<span class="m">168</span>.<span class="m">0</span>.<span class="m">1</span>
<span class="n">DNS</span>=<span class="m">8</span>.<span class="m">8</span>.<span class="m">8</span>.<span class="m">8</span>

<span class="c">## Conex√£o via DHCP
# [Network]
</span><span class="err">#</span> <span class="n">DHCP</span>=<span class="n">yes</span>
</pre></td></tr></tbody></table></code></pre></figure><p><strong>(4)</strong> - Depois crio um link simb√≥lico para o <code class="language-plaintext highlighter-rouge">DNS</code>:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">ln</span> <span class="nt">-sf</span> /run/systemd/resolve/stub-resolv.conf /etc/resolv.conf
</code></pre></div></div><h1 id="configurando-o-pacman">Configurando o Pacman</h1><p>Aqui habilito o reposit√≥rio <code class="language-plaintext highlighter-rouge">[multilib]</code> e ignoro alguns pacotes de serem instalados e atualizados.</p><blockquote><p>NOTA: Como eu uso kernel <em>LTS</em>, n√£o tenho mania de ficar atualizando kernel sempre, e tamb√©m n√£o uso os driver da minha GPU (<strong>NVIDIA</strong>) diretamente do repo do <strong>Arch Linux</strong>. Como o <strong>Arch Linux</strong> √© rolling-release e sempre disponibiliza a ‚Äú√∫ltima‚Äù vers√£o dos pacotes, tive alguns problemas com a √∫tilma vers√£o da <strong>NVIDIA</strong> em rela√ß√£o a minha GPU üò†, ent√£o instalo o driver (<code class="language-plaintext highlighter-rouge">.run</code>) baixado do pr√≥prio <a href="https://www.nvidia.com/en-us/drivers/unix/">site da NVIDIA</a> com uma vers√£o anterior, mas especificamente a <em>Latest New Feature Branch Version</em>.</p></blockquote><p><strong>(1)</strong> - Abro o <strong>/etc/pacman.conf</strong>:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vim /etc/pacman.conf
</code></pre></div></div><p><strong>(2)</strong> - Descomento as seguintes linhas do <code class="language-plaintext highlighter-rouge">[multilib]</code> deixando assim:</p><div class="language-conf highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[<span class="n">multilib</span>]
<span class="n">Include</span> = /<span class="n">etc</span>/<span class="n">pacman</span>.<span class="n">d</span>/<span class="n">mirrorlist</span>
</code></pre></div></div><p><strong>(3)</strong> - Ignoro atualiza√ß√£o/instala√ß√£o de alguns pacotes do repo do <strong>Arch Linux</strong> que n√£o uso, adicionando o seguintes:</p><div class="language-conf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">IgnorePkg</span>  = <span class="n">linux</span>-<span class="n">lts</span> <span class="n">linux</span> <span class="n">linux</span>-<span class="n">zen</span> <span class="n">linux</span>-<span class="n">headers</span> <span class="n">linux</span>-<span class="n">zen</span>-<span class="n">headers</span> <span class="n">linux</span>-<span class="n">lts</span>-<span class="n">headers</span>
<span class="n">nvidia</span>-<span class="n">utils</span> <span class="n">nvidia</span>-<span class="n">settings</span> <span class="n">nvidia</span> <span class="n">lib32</span>-<span class="n">nvidia</span> <span class="n">cuda</span>
</code></pre></div></div><p><strong>(4)</strong> - Adiciono meu pr√≥prio repo de algumas configura√ß√µes que fiz para minha m√°quina üòé:</p><figure class="highlight"><pre><code class="language-conf" data-lang="conf"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="code"><pre>[<span class="n">canin</span>]
<span class="n">SigLevel</span> = <span class="n">Optional</span> <span class="n">TrustAll</span>
<span class="n">Server</span> = <span class="n">https</span>://<span class="n">williamcanin</span>.<span class="n">gitlab</span>.<span class="n">io</span>/<span class="n">archlinux</span>/<span class="n">stable</span>/<span class="n">x86_64</span>
</pre></td></tr></tbody></table></code></pre></figure><p><strong>(5)</strong> - Atualizo o cache do pacman:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pacman <span class="nt">-Syy</span>
</code></pre></div></div><h1 id="configurando-home">Configurando /home</h1><p>O arquivo de configura√ß√£o para dispositivos criptografados lan√ßados ‚Äúdurante o boot‚Äù no <strong>Arch Linux</strong>, √© o <code class="language-plaintext highlighter-rouge">/etc/crypttab.initramfs</code>. Por padr√£o ele n√£o existe, ent√£o eu crio o mesmo atribuindo o <code class="language-plaintext highlighter-rouge">UUID</code> do dispositivo criptografado LUKS, que no caso √© o <code class="language-plaintext highlighter-rouge">/dev/sdb1</code>.</p><p><strong>(1)</strong> - Crio o arquivo <code class="language-plaintext highlighter-rouge">/etc/crypttab.initramfs</code> inserindo o <code class="language-plaintext highlighter-rouge">UUID</code> com a ajuda do <code class="language-plaintext highlighter-rouge">blkid</code>:</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="code"><pre><span class="nb">cat</span> <span class="o">&lt;&lt;</span> <span class="no">EOF</span><span class="sh"> &gt;&gt; /etc/crypttab.initramfs
# /dev/sdb1
home UUID=</span><span class="si">$(</span>blkid <span class="nt">-s</span> UUID <span class="nt">-o</span> value /dev/sdb1<span class="si">)</span><span class="sh"> none luks,tries=0,timeout=0
EOF</span>
</pre></td></tr></tbody></table></code></pre></figure><blockquote><p>ATEN√á√ÉO!!! N√£o confundir <code class="language-plaintext highlighter-rouge">/dev/sdb1</code> (dispositivo LUKS) com <code class="language-plaintext highlighter-rouge">/dev/mapper/home</code> (parti√ß√£o com sistema de arquivos).</p></blockquote><p><strong>(2)</strong> - Agora para a parti√ß√£o <code class="language-plaintext highlighter-rouge">/dev/mapper/home</code> iniciar com o sistema, insiro a mesma no arquivo <code class="language-plaintext highlighter-rouge">/etc/fstab</code>. Sigo basicamente a mesma ideia do comando de acima, copiando o <code class="language-plaintext highlighter-rouge">UUID</code> com o <code class="language-plaintext highlighter-rouge">blkid</code> mas dessa vez no <code class="language-plaintext highlighter-rouge">/etc/fstab</code>:</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="code"><pre><span class="nb">cat</span> <span class="o">&lt;&lt;</span> <span class="no">EOF</span><span class="sh"> &gt;&gt; /etc/fstab
# /dev/mapper/home
UUID=</span><span class="si">$(</span>blkid <span class="nt">-s</span> UUID <span class="nt">-o</span> value /dev/mapper/home<span class="si">)</span><span class="sh"> /home ext4 rw,relatime,data=ordered 0 2
EOF</span>
</pre></td></tr></tbody></table></code></pre></figure><blockquote><p>ATEN√á√ÉO!!! Observe que para inserir a configura√ß√£o no <code class="language-plaintext highlighter-rouge">/etc/fstab</code>, estou usando <strong>tee -a</strong>, este par√¢metro <strong>-a</strong> significa <strong>append</strong>, adicionar, se emitir ele, ir√° sobrescrever o <code class="language-plaintext highlighter-rouge">/etc/fstab</code>.</p></blockquote><h1 id="configurando-o-etcmkinitcpioconf">Configurando o /etc/mkinitcpio.conf</h1><p><strong>(1)</strong> - Aqui adiciono os m√≥dulos que preciso que carreguem durante o boot:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sed</span> <span class="nt">-i</span> <span class="s2">"s|^MODULES=.*|MODULES=(xhci_hcd ehci_hcd uhci_hcd usbhid)|g"</span> /etc/mkinitcpio.conf
</code></pre></div></div><p>O driver <code class="language-plaintext highlighter-rouge">usbhid</code> √© essencial para reconhecer dispositivos como teclados e mouses que se conectam via USB. J√° o <code class="language-plaintext highlighter-rouge">xhci_hcd</code> e <code class="language-plaintext highlighter-rouge">ehci_hcd</code> s√£o respons√°veis por fazer a ponte entre o hardware e os dispositivos USB.</p><blockquote><p>Bug: Como eu tenho a parti√ß√£o <code class="language-plaintext highlighter-rouge">/home</code> criptografada que necessita colocar a senha durante o boot, eu n√£o acrescento os m√≥dulos da minha GPU (NVIDIA) para n√£o dar ‚Äú<em>flicker</em>‚Äù na tela durante o boot, ocasionando quebra de linha do cursor no passphrase da <code class="language-plaintext highlighter-rouge">/home</code>.</p></blockquote><p><strong>(2)</strong> - Nos HOOKS adiciono a op√ß√£o de criptografia e <strong>LVM</strong>. Ent√£o fa√ßo assim:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sed</span> <span class="nt">-i</span> <span class="s2">"s|^HOOKS=.*|HOOKS=(base systemd autodetect keymap modconf kms keyboard sd-vconsole block sd-encrypt lvm2 filesystems fsck)|g"</span> /etc/mkinitcpio.conf
</code></pre></div></div><blockquote><p>Nota: Antigamente eu usava o <code class="language-plaintext highlighter-rouge">plymouth</code> depois de <code class="language-plaintext highlighter-rouge">keymap</code> para ter um boot com splash, mas hoje prefiro o boot verboso para averiguar alguma mensagem de erro, ou demora caso ocorra.</p></blockquote><p><strong>(3)</strong> - Agora instalo o pacote <code class="language-plaintext highlighter-rouge">lvm2</code>:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pacman <span class="nt">-S</span> lvm2
</code></pre></div></div><h1 id="instalando-o-bootloader">Instalando o bootloader</h1><p>J√° faz um bom tempo que uso <code class="language-plaintext highlighter-rouge">systemd-boot</code> por achar o <code class="language-plaintext highlighter-rouge">GRUB</code> pesado e com recursos que nem preciso.</p><p>Minha m√°quina √© <strong>EFI</strong>, por que eu teria que ter um bootloader pra gerenciar <em>Legacy</em> tamb√©m?! ü§î</p><p><strong>(1)</strong> - Primeiro instalo o <code class="language-plaintext highlighter-rouge">efibootmgr</code> e <code class="language-plaintext highlighter-rouge">intel-ucode</code>:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pacman <span class="nt">-S</span> <span class="nt">--noconfirm</span> efibootmgr intel-ucode
</code></pre></div></div><blockquote><p>Nota: O <code class="language-plaintext highlighter-rouge">efibootmgr</code> √© um ‚Äúgerenciador‚Äù de bootloader EFI, e o <code class="language-plaintext highlighter-rouge">intel-ucode</code> √© um microc√≥digo de seguran√ßa para CPU Intel. Na AMD como CPU, instalo o <code class="language-plaintext highlighter-rouge">amd-code</code>.</p></blockquote><p><strong>(2)</strong> - Depois fa√ßo de fato a instala√ß√£o o <code class="language-plaintext highlighter-rouge">systemd-boot</code> como bootloader:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bootctl <span class="nt">--path</span><span class="o">=</span>/boot <span class="nb">install</span>
</code></pre></div></div><div class="details-start" data-summary="Com parti√ß√£o de boot separada"></div><script>(function(){
  if (window.__jekyll_details_setup) return;
  window.__jekyll_details_setup = true;

  function initDetails(){
    const starts = document.querySelectorAll('.details-start');
    starts.forEach(start => {
      const summary = start.getAttribute('data-summary') || 'Detalhes';

      let end = start.nextSibling;
      while(end && !(end.nodeType === 1 && end.classList.contains('details-end'))){
        end = end.nextSibling;
      }
      if(!end) return;

      let node = start.nextSibling;
      const content = [];
      while(node && node !== end){
        const next = node.nextSibling;
        if(node.nodeType === Node.ELEMENT_NODE || (node.nodeType === Node.TEXT_NODE && node.textContent.trim())){
          content.push(node.cloneNode(true));
        }
        node = next;
      }

      const details = document.createElement('details');
      const sum = document.createElement('summary');
      sum.textContent = summary;
      details.appendChild(sum);

      const wrapper = document.createElement('div');
      wrapper.className = 'details-content-wrapper';

      content.forEach(el => wrapper.appendChild(el));

      details.appendChild(wrapper);

      start.parentNode.insertBefore(details, start);
      let cur = start;
      while(cur){
        const next = cur.nextSibling;
        cur.remove();
        if(cur === end) break;
        cur = next;
      }
    });
  }

  if(document.readyState === 'loading')
    document.addEventListener('DOMContentLoaded', initDetails);
  else
    initDetails();
})();</script><p>Se eu instalei o sistema com a parti√ß√£o de boot separada, ent√£o minha instala√ß√£o do bootloader fica assim:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bootctl <span class="nt">--path</span><span class="o">=</span>/boot/efi <span class="nb">install</span>
</code></pre></div></div><div class="details-end"></div><p><strong>(3)</strong> - Crio o loader do <code class="language-plaintext highlighter-rouge">systemd-boot</code>:</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="code"><pre><span class="nv">ESP_DIR</span><span class="o">=</span><span class="s2">""</span><span class="p">;</span>
<span class="nb">cat</span> <span class="o">&lt;&lt;</span> <span class="no">EOF</span><span class="sh"> &gt; /boot/</span><span class="k">${</span><span class="nv">ESP_DIR</span><span class="k">}</span><span class="sh">loader/loader.conf
default arch-linux-lts.efi
timeout 3
console-mode max
editor no
EOF</span>
</pre></td></tr></tbody></table></code></pre></figure><blockquote><p>IMPORTANTE: Est√° vari√°vel de ambiente <code class="language-plaintext highlighter-rouge">ESP_DIR</code> √© tempor√°ria, √© apenas para o momento de instala√ß√£o. Se instalou o sistema com a parti√ß√£o de boot separada, um em <code class="language-plaintext highlighter-rouge">/boot</code> e outra <code class="language-plaintext highlighter-rouge">/boot/efi</code>, ent√£o a vari√°vel <code class="language-plaintext highlighter-rouge">ESP_DIR</code> DEVE ser assim: <code class="language-plaintext highlighter-rouge">ESP_DIR="efi/"</code>. Caso contr√°rio deixe vazio.</p></blockquote><blockquote><p>Nota: Na op√ß√£o <code class="language-plaintext highlighter-rouge">default</code>, se usar UKI, colocar o nome do UKI completo, por exemplo: <code class="language-plaintext highlighter-rouge">arch-linux-lts.efi</code>. Se usar modo tradicional, usar o nome do arquivo presente no diret√≥rio <code class="language-plaintext highlighter-rouge">entries</code> , por exemplo: <code class="language-plaintext highlighter-rouge">arch.conf</code>.</p></blockquote><h2 id="usando-uki-unified-kernel-image">Usando UKI (Unified Kernel Image)</h2><p>Atualmente estou usando <code class="language-plaintext highlighter-rouge">systemd-boot</code> + <code class="language-plaintext highlighter-rouge">UKI</code> (Unified Kernel Image), e esses s√£o os passos que fa√ßo para instalar.</p><p><strong>(1)</strong> - Crio um backup do ‚Äú<em>preset</em>‚Äù primeiro:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cp</span> /etc/mkinitcpio.d/linux-lts.preset /etc/mkinitcpio.d/linux-lts.preset.backup
</code></pre></div></div><p><strong>(2)</strong> - Depois crio um novo <code class="language-plaintext highlighter-rouge">/etc/mkinitcpio.d/linux-lts.preset</code> com as configura√ß√µes abaixo:</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td><td class="code"><pre><span class="nb">cat</span> <span class="o">&lt;&lt;</span> <span class="no">EOF</span><span class="sh"> &gt; /etc/mkinitcpio.d/linux-lts.preset
ESP_DIR="</span><span class="k">${</span><span class="nv">ESP_DIR</span><span class="k">}</span><span class="sh">"

ALL_config="/etc/mkinitcpio.conf"
ALL_kver="/boot/</span><span class="se">\$</span><span class="sh">{ESP_DIR}vmlinuz-linux-lts"
ALL_cmdline="root=UUID=</span><span class="si">$(</span>blkid <span class="nt">-s</span> UUID <span class="nt">-o</span> value /dev/mapper/linux-arch<span class="si">)</span><span class="sh"> rw loglevel=3 nvidia_drm.modeset=1 video=1920x1080@75"
PRESETS=('default' 'fallback')

default_config="/etc/mkinitcpio.conf"
default_image="/boot/</span><span class="se">\$</span><span class="sh">{ESP_DIR}initramfs-linux-lts.img"
default_uki="/boot/</span><span class="se">\$</span><span class="sh">{ESP_DIR}EFI/Linux/arch-linux-lts.efi"
default_options="--splash /usr/share/systemd/bootctl/splash-arch.bmp"

fallback_config="/etc/mkinitcpio.conf"
fallback_image="/boot/</span><span class="se">\$</span><span class="sh">{ESP_DIR}initramfs-linux-lts-fallback.img"
fallback_uki="/boot/</span><span class="se">\$</span><span class="sh">{ESP_DIR}EFI/Linux/arch-linux-lts-fallback.efi"
fallback_options="-S autodetect"
EOF</span>
</pre></td></tr></tbody></table></code></pre></figure><blockquote><p>Dica: Caso eu queira um boot menos verboso e com splash, eu adiciono na op√ß√£o <code class="language-plaintext highlighter-rouge">ALL_cmdline</code> os par√¢mentros: <code class="language-plaintext highlighter-rouge">quiet splash loglevel=3 systemd.show_status=auto rd.udev.log_level=3</code>. E depois instalo o pacote <code class="language-plaintext highlighter-rouge">plymouth</code>, e adiciono a flag <code class="language-plaintext highlighter-rouge">plymouth</code> nos HOOKS do <code class="language-plaintext highlighter-rouge">/etc/mkinitcpio.conf</code> depois de <code class="language-plaintext highlighter-rouge">keymap</code>.</p></blockquote><p><strong>(3)</strong> - Reinstalo o kernel:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pacman <span class="nt">-S</span> <span class="nt">--noconfirm</span> linux-lts
</code></pre></div></div><div class="details-start" data-summary="Usando modo tradicional (Opcional)"></div><script>(function(){
  if (window.__jekyll_details_setup) return;
  window.__jekyll_details_setup = true;

  function initDetails(){
    const starts = document.querySelectorAll('.details-start');
    starts.forEach(start => {
      const summary = start.getAttribute('data-summary') || 'Detalhes';

      let end = start.nextSibling;
      while(end && !(end.nodeType === 1 && end.classList.contains('details-end'))){
        end = end.nextSibling;
      }
      if(!end) return;

      let node = start.nextSibling;
      const content = [];
      while(node && node !== end){
        const next = node.nextSibling;
        if(node.nodeType === Node.ELEMENT_NODE || (node.nodeType === Node.TEXT_NODE && node.textContent.trim())){
          content.push(node.cloneNode(true));
        }
        node = next;
      }

      const details = document.createElement('details');
      const sum = document.createElement('summary');
      sum.textContent = summary;
      details.appendChild(sum);

      const wrapper = document.createElement('div');
      wrapper.className = 'details-content-wrapper';

      content.forEach(el => wrapper.appendChild(el));

      details.appendChild(wrapper);

      start.parentNode.insertBefore(details, start);
      let cur = start;
      while(cur){
        const next = cur.nextSibling;
        cur.remove();
        if(cur === end) break;
        cur = next;
      }
    });
  }

  if(document.readyState === 'loading')
    document.addEventListener('DOMContentLoaded', initDetails);
  else
    initDetails();
})();</script><p>Aqui a configura√ß√£o do <strong>systemd-boot</strong> muda, em vez de usar UKI, uso os arquivos <strong>vmlinuz-linux-lts</strong>, <strong>initramfs-linux-lts.img</strong> e <strong>intel-ucode.img</strong> para iniciar o boot.</p><p><strong>(1)</strong> - Primeiro removo qualquer imagem <code class="language-plaintext highlighter-rouge">.efi</code> gerada:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">rm</span> <span class="nt">-f</span> /boot/<span class="k">${</span><span class="nv">ESP_DIR</span><span class="k">}</span>EFI/Linux/arch-linux-lts<span class="k">*</span>.efi
</code></pre></div></div><p><strong>(2)</strong> - Depois eu crio a entrada padr√£o assim:</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="code"><pre><span class="nb">cat</span> <span class="o">&lt;&lt;</span> <span class="no">EOF</span><span class="sh"> &gt; /boot/</span><span class="k">${</span><span class="nv">ESP_DIR</span><span class="k">}</span><span class="sh">loader/entries/arch.conf
title Arch Linux (Default)
linux /vmlinuz-linux-lts
initrd  /intel-ucode.img
initrd /initramfs-linux-lts.img
options root=UUID=</span><span class="si">$(</span>blkid <span class="nt">-s</span> UUID <span class="nt">-o</span> value /dev/mapper/linux-arch<span class="si">)</span><span class="sh"> rw nvidia_drm.modeset=1 video=1920x1080@75
EOF</span>
</pre></td></tr></tbody></table></code></pre></figure><p><strong>(2)</strong> - E a entrada de fallback assim:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cat</span> <span class="o">&lt;&lt;</span> <span class="no">EOF</span><span class="sh"> &gt; /boot/</span><span class="k">${</span><span class="nv">ESP_DIR</span><span class="k">}</span><span class="sh">loader/entries/arch-fallback.conf
title Arch Linux (Fallback)
linux /vmlinuz-linux-lts-fallback
initrd  /intel-ucode.img
initrd /initramfs-linux-ltsfallback.img
options root=UUID=</span><span class="si">$(</span>blkid <span class="nt">-s</span> UUID <span class="nt">-o</span> value /dev/mapper/linux-arch<span class="si">)</span><span class="sh"> rw nvidia_drm.modeset=1 video=1920x1080@75
</span><span class="no">EOF
</span></code></pre></div></div><blockquote><p>Nota: Nas entradas de boot, em <code class="language-plaintext highlighter-rouge">options</code>, vale a mesma configura√ß√£o do <code class="language-plaintext highlighter-rouge">ALL_cmdline</code> do <strong>UKI</strong>.</p></blockquote><div class="details-end"></div><div class="details-start" data-summary="Adicionando EFI do Windows (Opcional)"></div><script>(function(){
  if (window.__jekyll_details_setup) return;
  window.__jekyll_details_setup = true;

  function initDetails(){
    const starts = document.querySelectorAll('.details-start');
    starts.forEach(start => {
      const summary = start.getAttribute('data-summary') || 'Detalhes';

      let end = start.nextSibling;
      while(end && !(end.nodeType === 1 && end.classList.contains('details-end'))){
        end = end.nextSibling;
      }
      if(!end) return;

      let node = start.nextSibling;
      const content = [];
      while(node && node !== end){
        const next = node.nextSibling;
        if(node.nodeType === Node.ELEMENT_NODE || (node.nodeType === Node.TEXT_NODE && node.textContent.trim())){
          content.push(node.cloneNode(true));
        }
        node = next;
      }

      const details = document.createElement('details');
      const sum = document.createElement('summary');
      sum.textContent = summary;
      details.appendChild(sum);

      const wrapper = document.createElement('div');
      wrapper.className = 'details-content-wrapper';

      content.forEach(el => wrapper.appendChild(el));

      details.appendChild(wrapper);

      start.parentNode.insertBefore(details, start);
      let cur = start;
      while(cur){
        const next = cur.nextSibling;
        cur.remove();
        if(cur === end) break;
        cur = next;
      }
    });
  }

  if(document.readyState === 'loading')
    document.addEventListener('DOMContentLoaded', initDetails);
  else
    initDetails();
})();</script><p>Quando quero fazer um dual-boot com <strong>Windows</strong> ou at√© mesmo usar o Windows instalado em outra SSD/HDD, e adicionar o mesmo no <strong>systemd-boot</strong>, eu fa√ßo os passos abaixo:</p><p><strong>(1)</strong> - Acho a parti√ß√£o de bootloader do Windows, por exemplo, <strong>sdc1</strong> e monto a mesma:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mount <span class="nt">--mkdir</span> /dev/sdc1 /mnt/winboot
</code></pre></div></div><p><strong>(2)</strong> - Depois eu copio a pasta <strong>Microsoft</strong> para meu <code class="language-plaintext highlighter-rouge">/boot/EFI</code>:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cp</span> <span class="nt">-r</span> /mnt/winboot/EFI/Microsoft /boot/<span class="k">${</span><span class="nv">ESP_DIR</span><span class="k">}</span>EFI
</code></pre></div></div><p><strong>(3)</strong> - Crio o arquivo de entrada para o <strong>Windows</strong>:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cat</span> <span class="o">&lt;&lt;</span> <span class="no">EOF</span><span class="sh"> &gt; /boot/</span><span class="k">${</span><span class="nv">ESP_DIR</span><span class="k">}</span><span class="sh">loader/entries/windows.conf
title   Windows 11
efi     /EFI/Microsoft/Boot/bootmgfw.efi
</span><span class="no">EOF
</span></code></pre></div></div><div class="details-end"></div><div class="details-start" data-summary="Reinstalando o bootloader (Manuten√ß√£o)"></div><script>(function(){
  if (window.__jekyll_details_setup) return;
  window.__jekyll_details_setup = true;

  function initDetails(){
    const starts = document.querySelectorAll('.details-start');
    starts.forEach(start => {
      const summary = start.getAttribute('data-summary') || 'Detalhes';

      let end = start.nextSibling;
      while(end && !(end.nodeType === 1 && end.classList.contains('details-end'))){
        end = end.nextSibling;
      }
      if(!end) return;

      let node = start.nextSibling;
      const content = [];
      while(node && node !== end){
        const next = node.nextSibling;
        if(node.nodeType === Node.ELEMENT_NODE || (node.nodeType === Node.TEXT_NODE && node.textContent.trim())){
          content.push(node.cloneNode(true));
        }
        node = next;
      }

      const details = document.createElement('details');
      const sum = document.createElement('summary');
      sum.textContent = summary;
      details.appendChild(sum);

      const wrapper = document.createElement('div');
      wrapper.className = 'details-content-wrapper';

      content.forEach(el => wrapper.appendChild(el));

      details.appendChild(wrapper);

      start.parentNode.insertBefore(details, start);
      let cur = start;
      while(cur){
        const next = cur.nextSibling;
        cur.remove();
        if(cur === end) break;
        cur = next;
      }
    });
  }

  if(document.readyState === 'loading')
    document.addEventListener('DOMContentLoaded', initDetails);
  else
    initDetails();
})();</script><p>Caso eu precise reinstalar o <strong>systemd-boot</strong> ap√≥s um update ou reinstala√ß√£o de outro sistema operacional, sigo as etapas abaixo ap√≥s entrar na ISO do <strong>Arch Linux</strong>:</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="code"><pre>mount /dev/mapper/linux-arch /mnt<span class="p">;</span>
mount <span class="nt">--mkdir</span> /dev/sda1 /mnt/boot<span class="p">;</span>
mount <span class="nt">--mkdir</span> /dev/mapper/home /mnt/home<span class="p">;</span>
<span class="k">for </span><span class="nb">dir </span><span class="k">in </span>proc sys dev run<span class="p">;</span> <span class="k">do </span>mount <span class="nt">--rbind</span> /<span class="nv">$dir</span> /mnt/<span class="nv">$dir</span><span class="p">;</span> <span class="k">done</span><span class="p">;</span>
arch-chroot /mnt<span class="p">;</span>
pacman <span class="nt">-S</span> <span class="nt">--noconfirm</span> linux-lts linux-lts-headers<span class="p">;</span>
mkinitcpio <span class="nt">-P</span><span class="p">;</span>
bootctl <span class="nt">--path</span><span class="o">=</span>/boot <span class="nb">install</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></pre></figure><blockquote><p>Nota 1: Ent√£o Repito os passos de: <strong>Instalando o bootloader</strong>. Nota 2: Lembrando que, se usar <code class="language-plaintext highlighter-rouge">/boot</code> e <code class="language-plaintext highlighter-rouge">/boot/efi</code>, montar ambos e usar o <code class="language-plaintext highlighter-rouge">bootctl</code> em <code class="language-plaintext highlighter-rouge">/boot/efi</code>.</p></blockquote><div class="details-end"></div><h1 id="instala√ß√£o-de-drivers-gr√°ficos">Instala√ß√£o de drivers gr√°ficos</h1><p>Agora vou de fato para o ambiente gr√°fico. Ent√£o come√ßo a instalar alguns drivers essenciais e API, como <strong>Vulkan</strong>, <strong>OpenGL</strong>, etc:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pacman <span class="nt">-S</span> <span class="nt">--needed</span> <span class="nt">--noconfirm</span> xorg wayland dialog mesa lib32-mesa xf86-video-vesa vulkan-icd-loader <span class="se">\</span>
lib32-vulkan-icd-loader vulkan-tools
</code></pre></div></div><p><strong>Intel:</strong></p><p>Como uso <a href="https://www.intel.com.br/content/www/br/pt/products/details/processors/core.html">Intel</a>, ent√£o tamb√©m instalo esses drivers para GPU integrada:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pacman <span class="nt">-S</span> <span class="nt">--needed</span> <span class="nt">--noconfirm</span> mesa-vulkan-intel vulkan-intel linux-firmware-intel
</code></pre></div></div><div class="details-start" data-summary="AMD"></div><script>(function(){
  if (window.__jekyll_details_setup) return;
  window.__jekyll_details_setup = true;

  function initDetails(){
    const starts = document.querySelectorAll('.details-start');
    starts.forEach(start => {
      const summary = start.getAttribute('data-summary') || 'Detalhes';

      let end = start.nextSibling;
      while(end && !(end.nodeType === 1 && end.classList.contains('details-end'))){
        end = end.nextSibling;
      }
      if(!end) return;

      let node = start.nextSibling;
      const content = [];
      while(node && node !== end){
        const next = node.nextSibling;
        if(node.nodeType === Node.ELEMENT_NODE || (node.nodeType === Node.TEXT_NODE && node.textContent.trim())){
          content.push(node.cloneNode(true));
        }
        node = next;
      }

      const details = document.createElement('details');
      const sum = document.createElement('summary');
      sum.textContent = summary;
      details.appendChild(sum);

      const wrapper = document.createElement('div');
      wrapper.className = 'details-content-wrapper';

      content.forEach(el => wrapper.appendChild(el));

      details.appendChild(wrapper);

      start.parentNode.insertBefore(details, start);
      let cur = start;
      while(cur){
        const next = cur.nextSibling;
        cur.remove();
        if(cur === end) break;
        cur = next;
      }
    });
  }

  if(document.readyState === 'loading')
    document.addEventListener('DOMContentLoaded', initDetails);
  else
    initDetails();
})();</script><p>N√£o estou usando <strong>AMD</strong> no momento, mas vou deixar os drivers necess√°rios caso eu use futuramente:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pacman <span class="nt">-S</span> <span class="nt">--needed</span> <span class="nt">--noconfirm</span> mesa-vulkan-radeon vulkan-radeon linux-firmware-radeon
</code></pre></div></div><div class="details-end"></div><p><strong>NVIDIA (Nouveau)</strong></p><p>Sempe bom ter os drivers da NVIDIA open-source caso a NVIDIA fa√ßa alguma ‚Äúnhaca‚Äù de incompatibilidade:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pacman <span class="nt">-S</span> <span class="nt">--noconfirm</span>  xf86-video-nouveau vulkan-nouveau
</code></pre></div></div><div class="details-start" data-summary="NVIDIA (proprietary) üôÑ"></div><script>(function(){
  if (window.__jekyll_details_setup) return;
  window.__jekyll_details_setup = true;

  function initDetails(){
    const starts = document.querySelectorAll('.details-start');
    starts.forEach(start => {
      const summary = start.getAttribute('data-summary') || 'Detalhes';

      let end = start.nextSibling;
      while(end && !(end.nodeType === 1 && end.classList.contains('details-end'))){
        end = end.nextSibling;
      }
      if(!end) return;

      let node = start.nextSibling;
      const content = [];
      while(node && node !== end){
        const next = node.nextSibling;
        if(node.nodeType === Node.ELEMENT_NODE || (node.nodeType === Node.TEXT_NODE && node.textContent.trim())){
          content.push(node.cloneNode(true));
        }
        node = next;
      }

      const details = document.createElement('details');
      const sum = document.createElement('summary');
      sum.textContent = summary;
      details.appendChild(sum);

      const wrapper = document.createElement('div');
      wrapper.className = 'details-content-wrapper';

      content.forEach(el => wrapper.appendChild(el));

      details.appendChild(wrapper);

      start.parentNode.insertBefore(details, start);
      let cur = start;
      while(cur){
        const next = cur.nextSibling;
        cur.remove();
        if(cur === end) break;
        cur = next;
      }
    });
  }

  if(document.readyState === 'loading')
    document.addEventListener('DOMContentLoaded', initDetails);
  else
    initDetails();
})();</script><p>Como j√° relatei acima, n√£o uso o driver propriet√°rio da <strong>NVIDIA</strong> do repo do <strong>Arch Linux</strong> por algumas incompatibilidades que tive na √∫ltima vers√£o üò°, mas mesmo assim vou deixar os pacotes essenciais que se deve instalar:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pacman <span class="nt">-S</span> <span class="nt">--needed</span> <span class="nt">--noconfirm</span> nvidia nvidia-utils lib32-nvidia-utils nvidia-settings opencl-nvidia<span class="p">;</span>
systemctl set-default multi-user.target
</code></pre></div></div><div class="details-end"></div><h1 id="instala√ß√£o-de-fontes">Instala√ß√£o de fontes</h1><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pacman <span class="nt">-S</span> <span class="nt">--needed</span> <span class="nt">--noconfirm</span> noto-fonts noto-fonts-emoji noto-fonts-cjk ttf-liberation <span class="se">\</span>
otf-font-awesome ttf-jetbrains-mono ttf-jetbrains-mono-nerd ttf-dejavu-nerd
</code></pre></div></div><h1 id="instala√ß√£o-de-drivers-de-√°udio-e-mixer">Instala√ß√£o de drivers de √°udio e mixer</h1><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pacman <span class="nt">-S</span> <span class="nt">--needed</span> <span class="nt">--noconfirm</span> pipewire wireplumer pipewire-audio pipewire-pulse pipewire-alsa <span class="se">\</span>
pipewire-jack lib32-pipewire lsp-plugins-lv2 mda.lv2 zam-plugins-lv2 zam-plugins-lv2 pavucontrol
</code></pre></div></div><h1 id="ambiente-de-trabalho-i3">Ambiente de trabalho (i3)</h1><p>Atualmente uso <strong>i3</strong> + <strong>Polybar</strong>, e esses s√£o os pacotes que uso para um ambiente agrad√°vel:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pacman <span class="nt">-S</span> <span class="nt">--needed</span> <span class="nt">--noconfirm</span> i3 i3lock i3status polybar pcmanfm picom rofi nitrogen gtk-chtheme <span class="se">\</span>
btop jq conky gsimplecal numlockx qt5ct qt6ct scrot dunst yazi xautolock imagemagick ranger lynx
</code></pre></div></div><div class="details-start" data-summary="Ambiente de trabalho (XFCE)"></div><script>(function(){
  if (window.__jekyll_details_setup) return;
  window.__jekyll_details_setup = true;

  function initDetails(){
    const starts = document.querySelectorAll('.details-start');
    starts.forEach(start => {
      const summary = start.getAttribute('data-summary') || 'Detalhes';

      let end = start.nextSibling;
      while(end && !(end.nodeType === 1 && end.classList.contains('details-end'))){
        end = end.nextSibling;
      }
      if(!end) return;

      let node = start.nextSibling;
      const content = [];
      while(node && node !== end){
        const next = node.nextSibling;
        if(node.nodeType === Node.ELEMENT_NODE || (node.nodeType === Node.TEXT_NODE && node.textContent.trim())){
          content.push(node.cloneNode(true));
        }
        node = next;
      }

      const details = document.createElement('details');
      const sum = document.createElement('summary');
      sum.textContent = summary;
      details.appendChild(sum);

      const wrapper = document.createElement('div');
      wrapper.className = 'details-content-wrapper';

      content.forEach(el => wrapper.appendChild(el));

      details.appendChild(wrapper);

      start.parentNode.insertBefore(details, start);
      let cur = start;
      while(cur){
        const next = cur.nextSibling;
        cur.remove();
        if(cur === end) break;
        cur = next;
      }
    });
  }

  if(document.readyState === 'loading')
    document.addEventListener('DOMContentLoaded', initDetails);
  else
    initDetails();
})();</script><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pacman <span class="nt">-S</span> <span class="nt">--needed</span> <span class="nt">--noconfirm</span> xfce4 xfce4-goodies appmenu-gtk-module libdbusmenu-glib lightdm <span class="se">\</span>
lightdm-gtk-greeter
</code></pre></div></div><div class="details-end"></div><div class="details-start" data-summary="Instala√ß√£o do ambiente de trabalho (GNOME)"></div><script>(function(){
  if (window.__jekyll_details_setup) return;
  window.__jekyll_details_setup = true;

  function initDetails(){
    const starts = document.querySelectorAll('.details-start');
    starts.forEach(start => {
      const summary = start.getAttribute('data-summary') || 'Detalhes';

      let end = start.nextSibling;
      while(end && !(end.nodeType === 1 && end.classList.contains('details-end'))){
        end = end.nextSibling;
      }
      if(!end) return;

      let node = start.nextSibling;
      const content = [];
      while(node && node !== end){
        const next = node.nextSibling;
        if(node.nodeType === Node.ELEMENT_NODE || (node.nodeType === Node.TEXT_NODE && node.textContent.trim())){
          content.push(node.cloneNode(true));
        }
        node = next;
      }

      const details = document.createElement('details');
      const sum = document.createElement('summary');
      sum.textContent = summary;
      details.appendChild(sum);

      const wrapper = document.createElement('div');
      wrapper.className = 'details-content-wrapper';

      content.forEach(el => wrapper.appendChild(el));

      details.appendChild(wrapper);

      start.parentNode.insertBefore(details, start);
      let cur = start;
      while(cur){
        const next = cur.nextSibling;
        cur.remove();
        if(cur === end) break;
        cur = next;
      }
    });
  }

  if(document.readyState === 'loading')
    document.addEventListener('DOMContentLoaded', initDetails);
  else
    initDetails();
})();</script><p>Minha rela√ß√£o com <strong>GNOME</strong> √© entre amor e √≥dio. Instalo mas deixo com um ambiente de fallback:</p><p><strong>M√≠nimo:</strong></p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pacman <span class="nt">-S</span> <span class="nt">--needed</span> <span class="nt">--noconfirm</span> gnome-shell gnome-control-center gnome-terminal nautilus gdm <span class="se">\</span>
gnome-browser-connector gnome-shell-extensions gnome-tweaks
</code></pre></div></div><p><strong>Completo:</strong></p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pacman <span class="nt">-S</span> <span class="nt">--needed</span> <span class="nt">--noconfirm</span> gnome gnome-extra gnome-desktop gnome-shell-extensions <span class="se">\</span>
gnome-browser-connector gnome-tweaks gdm
</code></pre></div></div><div class="details-end"></div><h1 id="instala√ß√£o-de-aplica√ß√µes">Instala√ß√£o de aplica√ß√µes</h1><p>Algumas aplica√ß√µes b√°sicas que uso:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pacman <span class="nt">-S</span> <span class="nt">--needed</span> <span class="nt">--noconfirm</span> pacman-contrib util-linux dkms xdg-user-dirs ntfs-3g udisks2 <span class="se">\</span>
dosfstools mtools cpupower reflector samba git openssh tor virtualbox-guest-utils vlc <span class="se">\</span>
transmission-gtk gvfs gvfs-smb ttf-dejavu ttf-dejavu-nerd terminator veracrypt zip unzip xarchiver <span class="se">\</span>
gimp inkscape make gcc go ruby perl tk python nodejs npm arch-wiki-docs arch-wiki-lite zeal <span class="se">\</span>
qemu-full virt-manager piper steam-native-runtime firefox libreoffice-fresh libreoffice-fresh-pt-br <span class="se">\</span>
terminator galculator leafpad calf smplayer gparted rofimoji easyeffects gnome-keyring seahorse mpv
</code></pre></div></div><h1 id="habilitando-servi√ßos">Habilitando servi√ßos</h1><p>Neste momento habilito alguns servi√ßos para iniciar durante o boot:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>systemctl <span class="nb">enable </span>iptables.service smb.service nmb.service tor.service
</code></pre></div></div><h1 id="complementando-o-etcfstab">Complementando o /etc/fstab</h1><p>Meu computador n√£o tem leitor de disquete e CD/DVD (e quem tem?), mas mesmo asim eu mantenho a configura√ß√£o no <code class="language-plaintext highlighter-rouge">/etc/fstab</code>, e tamb√©m j√° deixo comentado para uma parti√ß√£o <strong>Windows</strong>, caso eu tenha um dia. Para essas configura√ß√µes, eu fa√ßo os comandos:</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="code"><pre><span class="nb">mkdir</span> <span class="nt">-p</span> /media/cdrom0<span class="p">;</span> <span class="nb">mkdir</span> /mnt/floppy<span class="p">;</span> <span class="nb">mkdir</span> /mnt/windows<span class="p">;</span>
<span class="nb">ln</span> <span class="nt">-s</span> /media/cdrom0 /media/cdrom<span class="p">;</span>
<span class="nb">cat</span> <span class="o">&lt;&lt;</span> <span class="no">EOF</span><span class="sh"> &gt;&gt; /etc/fstab
### CDROM
/dev/sr0  /media/cdrom0  udf,iso9660 user,noauto  0 0

### Floppy
/dev/fd0  /mnt/floppy  auto  defaults,user,noauto  0 0

### Windows (optional)
#UUID=XXXXX-XXXXX-XXXXX /mnt/windows  ntfs-3g defaults,user,rw,auto  0 0
EOF</span>
</pre></td></tr></tbody></table></code></pre></figure><h1 id="zram">ZRAM</h1><p>Geralmente n√£o for√ßo tanto meu computador a ponto de usar <strong>zram</strong>, mas mesmo assim eu configuro:</p><p><strong>1</strong> - Instalando o gerenciador de zram:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pacman <span class="nt">-S</span> <span class="nt">--needed</span> <span class="nt">--noconfirm</span> zram-generator
</code></pre></div></div><p><strong>2</strong> - Configurando um perfil equilibrado para <strong>zram</strong>:</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="code"><pre><span class="nb">cat</span> <span class="o">&lt;&lt;</span> <span class="sh">"</span><span class="no">EOF</span><span class="sh">" &gt; /etc/systemd/zram-generator.conf
[zram0]
zram-size = ram / 4
compression-algorithm = zstd
swap-priority = 50
fs-type = swap
EOF</span>
</pre></td></tr></tbody></table></code></pre></figure><blockquote><p>Nota: Caso eu queira um perfil mais agressivo, para jogar por exemplo, que necessite de <strong>zram</strong>, ent√£o eu uso este perfil abaixo:</p></blockquote><div class="details-start" data-summary="ZRAM: Perfil Agressivo"></div><script>(function(){
  if (window.__jekyll_details_setup) return;
  window.__jekyll_details_setup = true;

  function initDetails(){
    const starts = document.querySelectorAll('.details-start');
    starts.forEach(start => {
      const summary = start.getAttribute('data-summary') || 'Detalhes';

      let end = start.nextSibling;
      while(end && !(end.nodeType === 1 && end.classList.contains('details-end'))){
        end = end.nextSibling;
      }
      if(!end) return;

      let node = start.nextSibling;
      const content = [];
      while(node && node !== end){
        const next = node.nextSibling;
        if(node.nodeType === Node.ELEMENT_NODE || (node.nodeType === Node.TEXT_NODE && node.textContent.trim())){
          content.push(node.cloneNode(true));
        }
        node = next;
      }

      const details = document.createElement('details');
      const sum = document.createElement('summary');
      sum.textContent = summary;
      details.appendChild(sum);

      const wrapper = document.createElement('div');
      wrapper.className = 'details-content-wrapper';

      content.forEach(el => wrapper.appendChild(el));

      details.appendChild(wrapper);

      start.parentNode.insertBefore(details, start);
      let cur = start;
      while(cur){
        const next = cur.nextSibling;
        cur.remove();
        if(cur === end) break;
        cur = next;
      }
    });
  }

  if(document.readyState === 'loading')
    document.addEventListener('DOMContentLoaded', initDetails);
  else
    initDetails();
})();</script><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="code"><pre><span class="nb">cat</span> <span class="o">&lt;&lt;</span> <span class="sh">"</span><span class="no">EOF</span><span class="sh">" &gt; /etc/systemd/zram-generator.conf
[zram0]
zram-size = ram * 3/4
compression-algorithm = lz4
swap-priority = 100
fs-type = swap
EOF</span>
</pre></td></tr></tbody></table></code></pre></figure><div class="details-end"></div><p><strong>3</strong> - Depois de configurar, eu fa√ßo um <em>reset</em> no daemon e habilito o servi√ßo de <strong>ZRAM</strong>:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>systemctl daemon-reload<span class="p">;</span>
systemctl <span class="nb">enable</span> <span class="nt">--now</span> systemd-zram-setup@zram0.service
</code></pre></div></div><div class="details-start" data-summary="Swap (opcional)"></div><script>(function(){
  if (window.__jekyll_details_setup) return;
  window.__jekyll_details_setup = true;

  function initDetails(){
    const starts = document.querySelectorAll('.details-start');
    starts.forEach(start => {
      const summary = start.getAttribute('data-summary') || 'Detalhes';

      let end = start.nextSibling;
      while(end && !(end.nodeType === 1 && end.classList.contains('details-end'))){
        end = end.nextSibling;
      }
      if(!end) return;

      let node = start.nextSibling;
      const content = [];
      while(node && node !== end){
        const next = node.nextSibling;
        if(node.nodeType === Node.ELEMENT_NODE || (node.nodeType === Node.TEXT_NODE && node.textContent.trim())){
          content.push(node.cloneNode(true));
        }
        node = next;
      }

      const details = document.createElement('details');
      const sum = document.createElement('summary');
      sum.textContent = summary;
      details.appendChild(sum);

      const wrapper = document.createElement('div');
      wrapper.className = 'details-content-wrapper';

      content.forEach(el => wrapper.appendChild(el));

      details.appendChild(wrapper);

      start.parentNode.insertBefore(details, start);
      let cur = start;
      while(cur){
        const next = cur.nextSibling;
        cur.remove();
        if(cur === end) break;
        cur = next;
      }
    });
  }

  if(document.readyState === 'loading')
    document.addEventListener('DOMContentLoaded', initDetails);
  else
    initDetails();
})();</script><p>Caso eu prefiro usar <strong>Swap</strong> em arquivo em vez de <strong>zram</strong>, esses s√£o os passos:</p><p><strong>(1)</strong> - Criando arquivo para swap:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>fallocate <span class="nt">-l</span> 8G /swapfile
<span class="c"># ou: dd if=/dev/zero of=/swapfile bs=1M count=4096 status=progress</span>
</code></pre></div></div><p><strong>(2)</strong> - Dando permiss√µes:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">chmod </span>600 /swapfile
<span class="nb">chown </span>root:root /swapfile
</code></pre></div></div><p><strong>(3)</strong> - Ativando:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkswap /swapfile
swapon /swapfile
</code></pre></div></div><p><strong>(4)</strong> - Ativando swap no boot:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cat</span> <span class="o">&lt;&lt;</span> <span class="no">EOF</span><span class="sh"> &gt;&gt; /etc/fstab
### Swap
/swapfile none swap defaults 0 0
</span><span class="no">EOF
</span></code></pre></div></div><p><strong>(5)</strong> - Configurando <em>swappiness</em>:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">echo</span> <span class="s1">'vm.swappiness=10'</span> | <span class="nb">tee</span> <span class="nt">-a</span> /etc/sysctl.d/99-swap.conf
</code></pre></div></div><blockquote><p>Nota: O swappiness recomendado √©: 10 para SSD, 60 para HDD.</p></blockquote><div class="details-end"></div><h1 id="adicionando-um-usu√°rio">Adicionando um usu√°rio</h1><p><strong>1</strong> - Antes, vou liberar o grupo <code class="language-plaintext highlighter-rouge">sudo</code> no arquivo <code class="language-plaintext highlighter-rouge">/etc/sudoers</code> para meu usu√°rio pertencer a esse grupo e eu ter privil√©gios de <em>sudo</em>:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sed</span> <span class="nt">-i</span> <span class="s2">"s|# %sudo ALL=(ALL:ALL) ALL|%sudo ALL=(ALL:ALL) ALL|g"</span> /etc/sudoers
</code></pre></div></div><p><strong>2</strong> - Agora come√ßo a cria√ß√£o do grupo do meu usu√°rio e a cria√ß√£o do meu usu√°rio em si:</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="code"><pre><span class="nv">USERNAME_TEMP</span><span class="o">=</span><span class="s2">"will"</span><span class="p">;</span>
groupadd <span class="nv">$USERNAME_TEMP</span><span class="p">;</span>
useradd <span class="nt">-m</span> <span class="nt">-g</span> <span class="nv">$USERNAME_TEMP</span> <span class="nt">-G</span> <span class="nb">users</span>,tty,wheel,games,power,optical,storage,scanner,lp,audio,video,input,mail,root <span class="nt">-s</span> /bin/zsh <span class="nv">$USERNAME_TEMP</span><span class="p">;</span>
groupadd <span class="nb">sudo</span> <span class="nt">-U</span> <span class="nv">$USERNAME_TEMP</span><span class="p">;</span>
passwd <span class="nv">$USERNAME_TEMP</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></pre></figure><h1 id="idioma-e-regi√£o">Idioma e regi√£o</h1><p>Esses comandos s√£o necess√°rio para configurar o teclado e idioma do sistema, onde cada linha √© um comando:</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="code"><pre>timedatectl set-timezone America/Sao_Paulo<span class="p">;</span>
<span class="nb">echo</span> <span class="s2">"KEYMAP=br-abnt2"</span> <span class="o">&gt;</span> /etc/vconsole.conf<span class="p">;</span>
<span class="nb">sed</span> <span class="nt">-i</span> <span class="s2">"s|#en_US.UTF-8 UTF-8|en_US.UTF-8 UTF-8|g"</span> /etc/locale.gen<span class="p">;</span>
<span class="nb">sed</span> <span class="nt">-i</span> <span class="s2">"s|#pt_BR.UTF-8 UTF-8|pt_BR.UTF-8 UTF-8|g"</span> /etc/locale.gen<span class="p">;</span>
locale-gen<span class="p">;</span>
<span class="nb">echo </span><span class="nv">LANG</span><span class="o">=</span>pt_BR.UTF-8 | <span class="nb">tee</span> /etc/locale.conf<span class="p">;</span>
<span class="nb">rm</span> <span class="nt">-f</span> /etc/localtime <span class="o">&amp;&amp;</span> <span class="nb">ln</span> <span class="nt">-s</span> /usr/share/zoneinfo/America/Sao_Paulo /etc/localtime<span class="p">;</span>
hwclock <span class="nt">--systohc</span><span class="p">;</span>
<span class="nb">echo</span> <span class="s2">"archlinux"</span> | <span class="nb">tee</span> /etc/hostname<span class="p">;</span>
<span class="nb">printf</span> <span class="s2">"127.0.0.1        archlinux</span><span class="se">\n</span><span class="s2">"</span> <span class="o">&gt;&gt;</span> /etc/hosts<span class="p">;</span>
<span class="nb">echo </span><span class="nv">KEYMAP</span><span class="o">=</span>br-abnt2 | <span class="nb">tee</span> /etc/vconsole.conf<span class="p">;</span>
</pre></td></tr></tbody></table></code></pre></figure><h1 id="security-boot-opcional">Security Boot (Opcional)</h1><p><strong>(1)</strong> - Instalar o pacote <code class="language-plaintext highlighter-rouge">sbctl</code>:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pacman <span class="nt">-S</span> <span class="nt">--noconfirm</span> sbctl
</code></pre></div></div><p><strong>(2)</strong> - Criar as chaves e aplicar as assinaturas:</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="code"><pre>sbctl create-keys
sbctl sign <span class="nt">-s</span> <span class="nt">-o</span> /usr/lib/systemd/boot/efi/systemd-bootx64.efi.signed /usr/lib/systemd/boot/efi/systemd-bootx64.efi
sbctl sign <span class="nt">-s</span> /boot/EFI/BOOT/BOOTX64.EFI
sbctl sign <span class="nt">-s</span> /boot/EFI/Linux/arch-linux-lts.efi
sbctl sign <span class="nt">-s</span> /boot/EFI/Linux/arch-linux-lts-fallback.efi
sbctl verify
</pre></td></tr></tbody></table></code></pre></figure><div class="details-start" data-summary="Assinando EFI Windows"></div><script>(function(){
  if (window.__jekyll_details_setup) return;
  window.__jekyll_details_setup = true;

  function initDetails(){
    const starts = document.querySelectorAll('.details-start');
    starts.forEach(start => {
      const summary = start.getAttribute('data-summary') || 'Detalhes';

      let end = start.nextSibling;
      while(end && !(end.nodeType === 1 && end.classList.contains('details-end'))){
        end = end.nextSibling;
      }
      if(!end) return;

      let node = start.nextSibling;
      const content = [];
      while(node && node !== end){
        const next = node.nextSibling;
        if(node.nodeType === Node.ELEMENT_NODE || (node.nodeType === Node.TEXT_NODE && node.textContent.trim())){
          content.push(node.cloneNode(true));
        }
        node = next;
      }

      const details = document.createElement('details');
      const sum = document.createElement('summary');
      sum.textContent = summary;
      details.appendChild(sum);

      const wrapper = document.createElement('div');
      wrapper.className = 'details-content-wrapper';

      content.forEach(el => wrapper.appendChild(el));

      details.appendChild(wrapper);

      start.parentNode.insertBefore(details, start);
      let cur = start;
      while(cur){
        const next = cur.nextSibling;
        cur.remove();
        if(cur === end) break;
        cur = next;
      }
    });
  }

  if(document.readyState === 'loading')
    document.addEventListener('DOMContentLoaded', initDetails);
  else
    initDetails();
})();</script><p>A EFI do Windows existem muitos arquivos que devem ser assinados, por isso, fa√ßo da seguinte maneira retirado da pr√≥pria <a href="https://wiki.archlinux.org/title/Unified_Extensible_Firmware_Interface/Secure_Boot#Assisted_process_with_sbctl">Wiki do Arch Linux</a>:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> /boot/EFI/Microsoft
sbctl verify | <span class="nb">sed</span> <span class="s1">'s/‚úó /sbctl sign -s /e'</span>
</code></pre></div></div><blockquote><p>Nota: Para este passo ser realizado, primeiro tem que ter realizado o passo <strong>Adicionando EFI do Windows (Opcional)</strong>.</p></blockquote><div class="details-end"></div><p><strong>(4)</strong> - Reinicio a m√°quina com o comando abaixo para entrar automaticamente na <strong>BIOS</strong>:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>systemctl reboot <span class="nt">--firmware-setup</span>
</code></pre></div></div><p><strong>(5)</strong> - Quando estou dentro da <strong>BIOS</strong>, vou na aba <strong>Boot</strong> &gt; <strong>Security Boot</strong> deixando desabilitado, e no modo <strong>Custom</strong>. Em <strong>Key Management</strong>, apago TODAS as chaves e RESTAURO para o <strong>Setup Mode</strong>, feito isso, salvo e inicio o <strong>Arch Linux</strong> novamente.</p><p><strong>(6)</strong> - Ap√≥s estar dentro do <strong>Arch Linux</strong> novamente, executo o comando abaixo:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sbctl enroll-keys <span class="nt">--microsoft</span>
</code></pre></div></div><blockquote><p>Nota: Isso faz com que crie as chaves de assinatura na <strong>EFI</strong>, e a op√ß√£o <code class="language-plaintext highlighter-rouge">--microsoft</code> √© para habilitar assinatura no <strong>Windows</strong> tamb√©m (caso eu tenha dual-boot com Windows).</p></blockquote><p><strong>(7)</strong> - Reinicio a m√°quina novamente para entrar na <strong>BIOS</strong> igual o passo <strong>(4)</strong>. Agora, dentro da <strong>BIOS</strong>, habilito o <strong>Security Boot</strong> e salvo. Quando reinicio o <strong>Arch Linux</strong>, minha m√°quina j√° estar√° em modo <strong>Security Boot</strong>.</p><h1 id="p√≥s-instala√ß√£o">P√≥s Instala√ß√£o</h1><p>Ap√≥s estar dentro do <strong>Arch Linux</strong> com meu usu√°rio, outras configura√ß√µes que fa√ßo s√£o:</p><h2 id="instalando-yay">Instalando yay</h2><p><strong>(1)</strong> - Instalar um gerenciador de pacotes para o <strong>AUR</strong>, no caso, o <code class="language-plaintext highlighter-rouge">yay</code>:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone https://aur.archlinux.org/yay.git<span class="p">;</span>
<span class="nb">cd </span>yay <span class="o">&amp;&amp;</span> makepkg <span class="nt">-si</span> PKGBUILD
</code></pre></div></div><p><strong>(2)</strong> - Depois do <code class="language-plaintext highlighter-rouge">yay</code> instalado, instalo outros pacotes/programas essenciais do <strong>AUR</strong>:</p><div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>yay <span class="nt">-S</span> <span class="nt">--noconfirm</span> i3-volume spotify visual-studio-code-bin brave-bin google-chrome secure-delete <span class="se">\</span>
smem
</code></pre></div></div><h2 id="configurando-meu-shell">Configurando meu shell</h2><p>Uso o <strong>ZSH</strong> com <a href="https://ohmyz.sh/">Oh-My-ZSH</a>, plugins e <a href="https://startship.rs">Starship</a>, e fa√ßo assim:</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="code"><pre><span class="nb">sudo </span>pacman <span class="nt">-S</span> <span class="nt">--noconfirm</span> starship<span class="p">;</span>
sh <span class="nt">-c</span> <span class="s2">"</span><span class="si">$(</span>curl <span class="nt">-fsSL</span> https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh<span class="si">)</span><span class="s2">"</span><span class="p">;</span>
git clone https://github.com/zsh-users/zsh-autosuggestions <span class="k">${</span><span class="nv">ZSH_CUSTOM</span><span class="k">:-</span><span class="p">~/.oh-my-zsh/custom</span><span class="k">}</span>/plugins/zsh-autosuggestions<span class="p">;</span>
git clone https://github.com/zsh-users/zsh-syntax-highlighting.git <span class="k">${</span><span class="nv">ZSH_CUSTOM</span><span class="k">:-</span><span class="p">~/.oh-my-zsh/custom</span><span class="k">}</span>/plugins/zsh-syntax-highlighting<span class="p">;</span>
<span class="nv">new_plugins</span><span class="o">=</span><span class="s2">" zsh-autosuggestions zsh-syntax-highlighting"</span><span class="p">;</span>
<span class="nv">current_plugins</span><span class="o">=</span><span class="si">$(</span><span class="nb">grep</span> <span class="s1">'^plugins='</span> <span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/.zshrc"</span> | <span class="nb">sed</span> <span class="s1">'s/^plugins=(//; s/)//'</span><span class="si">)</span><span class="p">;</span>
<span class="nv">new_plugins_line</span><span class="o">=</span><span class="s2">"plugins=(</span><span class="k">${</span><span class="nv">current_plugins</span><span class="k">}${</span><span class="nv">new_plugins</span><span class="k">}</span><span class="s2">)"</span><span class="p">;</span>
<span class="nb">sed</span> <span class="nt">-i</span> <span class="s2">"s|^plugins=.*|</span><span class="k">${</span><span class="nv">new_plugins_line</span><span class="k">}</span><span class="s2">|"</span> <span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/.zshrc"</span><span class="p">;</span>
<span class="nb">echo</span> <span class="s2">"eval </span><span class="se">\"\$</span><span class="s2">(starship init zsh)</span><span class="se">\"</span><span class="s2">"</span> <span class="o">&gt;</span> <span class="s2">"</span><span class="k">${</span><span class="nv">ZSH_CUSTOM</span><span class="k">:-</span><span class="p">~/.oh-my-zsh/custom</span><span class="k">}</span><span class="s2">/themes/starship.zsh-theme"</span><span class="p">;</span>
<span class="nb">sed</span> <span class="nt">-i</span> <span class="s1">'s/^ZSH_THEME=".*"/ZSH_THEME="starship"/'</span> <span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/.zshrc"</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></pre></figure><blockquote><p>Nota: Geralmente eu apenas instalo o <a href="https://ohmyz.sh/">Oh-My-ZSH</a>, plugins e <a href="https://startship.rs">Starship</a>, e as configura√ß√µes do <code class="language-plaintext highlighter-rouge">~/.zshrc</code> e resgato do meu <strong>dotfiles</strong>, usando o <a href="https://github.com/snakypy/dotctrl">DotCtrl</a>, um gerenciador de dotfiles criado por mim mesmo üòÜ.</p></blockquote><h2 id="login-autom√°tico">Login autom√°tico</h2><p>Como eu uso criptografia dos meus dados, n√£o acho interessante ter que ficar colocando senha para entrar no <strong>ambiente gr√°fico</strong> ap√≥s descriptografar minha m√°quina em boot, ent√£o uso <strong>login autom√°tico</strong> atrav√©s do <strong>TTY</strong>. N√£o uso gerenciador de login, como o <strong>GDM</strong>, <strong>LightDM</strong>, etc.</p><p>Sabendo disso, os passos s√£o:</p><p><strong>(1)</strong> - Crio um servi√ßo no <strong>systemd</strong> para pular o prompt:</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="code"><pre><span class="nb">sudo mkdir</span> <span class="nt">-p</span> /etc/systemd/system/getty@tty1.service.d<span class="p">;</span>
<span class="nb">sudo cat</span> <span class="o">&lt;&lt;</span> <span class="no">EOF</span><span class="sh"> &gt; /etc/systemd/system/getty@tty1.service.d/skip-prompt.conf
[Service]
ExecStart=
ExecStart=-/usr/bin/agetty --skip-login --nonewline --noissue --autologin &lt;USER&gt; --noclear %I </span><span class="se">\$</span><span class="sh">TERM
EOF</span>
</pre></td></tr></tbody></table></code></pre></figure><blockquote><p>IMPORTANTE: Onde esta <code class="language-plaintext highlighter-rouge">&lt;USER&gt;</code> coloco o nome do meu usu√°rio.</p></blockquote><p><strong>(2)</strong> - Crio um novo arquivo <code class="language-plaintext highlighter-rouge">~/.xinitrc</code> (fazendo backup do mesmo caso exista) adicionando o <code class="language-plaintext highlighter-rouge">i3</code> para ser executado:</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="code"><pre><span class="o">[</span> <span class="nt">-f</span> <span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/.xinitrc"</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="nb">mv</span> <span class="nv">$HOME</span>/.xinitrc <span class="nv">$HOME</span>/.xinitrc.bak<span class="p">;</span>
<span class="nb">cat</span> <span class="o">&lt;&lt;</span> <span class="no">EOF</span><span class="sh"> &gt; </span><span class="nv">$HOME</span><span class="sh">/.xinitrc
exec i3
EOF</span>
</pre></td></tr></tbody></table></code></pre></figure><p><strong>(3)</strong> - Crio um novo arquivo <code class="language-plaintext highlighter-rouge">~/.zprofile</code> (fazendo backup do mesmo caso exista) e uma condi√ß√£o apenas para logar automaticamente quando estiver no <strong>tty1</strong>:</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><table class="rouge-table"><tbody><tr><td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="code"><pre><span class="o">[</span> <span class="nt">-f</span> <span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/.zprofile"</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="nb">mv</span> <span class="nv">$HOME</span>/.zprofile <span class="nv">$HOME</span>/.zprofile.bak<span class="p">;</span>
<span class="nb">cat</span> <span class="o">&lt;&lt;</span> <span class="no">EOF</span><span class="sh"> &gt; </span><span class="nv">$HOME</span><span class="sh">/.zprofile
if [ -z "</span><span class="se">\$</span><span class="sh">DISPLAY" ] &amp;&amp; [ "</span><span class="se">\$</span><span class="sh">XDG_VTNR" = 1 ]; then
  exec startx &amp;&gt;/dev/null
fi
EOF</span>
</pre></td></tr></tbody></table></code></pre></figure><h1 id="conclus√£o">Conclus√£o</h1><p>√ìbvio que fa√ßo muito mais otimiza√ß√µes e configura√ß√µes no meu <strong>Arch Linux</strong>, mas esses s√£o os passos e configura√ß√µes B√ÅSICAS que uso. Espero que esse guia tenha te ajudado, e se ajudou, curta com uma estrelinha ‚≠ê aqui. Flw.</p></div><div class="row post-modified"><time class="dt-modified" datetime="2017-04-27T14:33:43+00:00" itemprop="dateModified"><strong>Postagem atualizada em:</strong>&nbsp;12 Out, 2025</time></div><div class="row post-tags"><ul class="tag-list"><strong>[ tags ]:</strong>&nbsp;&nbsp;<li class="tag-list__item"><a class="tag-list__link" href="/blog/tags/archlinux">archlinux</a></li><strong>&nbsp;&nbsp;.&nbsp;&nbsp;</strong><li class="tag-list__item"><a class="tag-list__link" href="/blog/tags/criptografia">criptografia</a></li><strong>&nbsp;&nbsp;.&nbsp;&nbsp;</strong><li class="tag-list__item"><a class="tag-list__link" href="/blog/tags/encryption">encryption</a></li><strong>&nbsp;&nbsp;.&nbsp;&nbsp;</strong><li class="tag-list__item"><a class="tag-list__link" href="/blog/tags/luks">luks</a></li><strong>&nbsp;&nbsp;.&nbsp;&nbsp;</strong><li class="tag-list__item"><a class="tag-list__link" href="/blog/tags/lvm">lvm</a></li><strong>&nbsp;&nbsp;.&nbsp;&nbsp;</strong></ul></div></div><div class="post-end text-center">/&nbsp;/&nbsp;/&nbsp;/&nbsp;&nbsp;end of post&nbsp;&nbsp;/&nbsp;/&nbsp;/&nbsp;/</div><div class="row comments"><h1 class="comments-title">[&nbsp;coment√°rios&nbsp;]</h1><div class="row comments-content"><script src="https://giscus.app/client.js" data-repo="williamcanin/williamcanin.github.io" data-repo-id="MDEwOlJlcG9zaXRvcnk0MDMyOTUzOQ==" data-category-id="DIC_kwDOAmdhQ84CwLFu" data-mapping="pathname" data-strict="0" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="bottom" data-theme="noborder_light" data-lang="pt" crossorigin="anonymous" async></script></div></div><div class="row related-posts"><h3 class="related-posts-title">[&nbsp;postagens relacionadas&nbsp;]</h3><ul class="related-posts-list"><li class="related-posts-list__item"><span class="related-posts-list__meta">07 Mar, 2019</span>&nbsp;¬ª&nbsp;<a class="related-posts-list__link" href="/blog/corrigindo-erro-de-chaves-no-archlinux/">Corrigindo erro de chaves no Arch Linux</a></li></ul></div></article></main><footer class="container-fluid fixed-bottom footer"><div class="row top"><div class="col-md d-flex justify-content-end"><a id="top-link" class="top-link" href="#top">^</a></div></div><div class="row footer-wrapper"><div class="col-md footer-copyright-wrap"><div class="footer-copyright">¬©&nbsp;Hey, I'm William Canin &nbsp;2015-2025&nbsp;-&nbsp;Todos os direitos reservados&nbsp;|&nbsp;<a href="/licenses/">Licen√ßas</a></div></div><div class="col-md footer-message-wrap"><div class="footer-message">Doing stuff on the web since 2007</div></div><div class="col-md footer-made-by-wrap"><div class="footer-made-by">Using the <a href="https://github.com/williamcanin/rawfeed" target="_blank" rel="noopener noreferrer">rawfeed</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener noreferrer">Jekyll</a>.</div></div></div></footer></div></body><script src="/assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script><script>window.giscusThemes = {
      light: "noborder_light",
      dark: "noborder_gray"
    };</script><script src="/assets/js/default.js"></script></html>