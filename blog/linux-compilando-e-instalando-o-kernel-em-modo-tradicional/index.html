<!DOCTYPE html><html id="top" lang="pt" data-theme="light"><head><meta name="viewport" content="width=device-width,initial-scale=1"><meta charset="utf-8"><title>Linux: Compilando e instalando o kernel em modo tradicional | william canin</title><script>if (window.top !== window.self) {
        // Prevents the site from being displayed inside an <iframe>
        window.top.location = window.self.location;
      }</script><meta http-equiv="Content-Security-Policy" content="
        default-src 'self';
        img-src 'self' data: https://www.google.com https://media0.giphy.com https://media4.giphy.com https://github.githubassets.com;
        script-src 'self' 'unsafe-inline'
        https://www.google.com/recaptcha
        https://www.google.com
        https://www.gstatic.com
        https://cdn.jsdelivr.net
        https://cdnjs.cloudflare.com
        https://giscus.app
        https://disqus.com;
        style-src 'self' 'unsafe-inline'
        https://cdnjs.cloudflare.com
        https://fonts.googleapis.com
        https://cdn.jsdelivr.net
        https://giscus.app
        https://disqus.com;
        font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com data:;
        connect-src 'self' https://api.github.com https://www.google.com;
        frame-src https://www.youtube.com https://giscus.app https://disqus.com https://www.google.com;
        object-src 'none';
        base-uri 'self';
        form-action 'self';
    "><meta http-equiv="Strict-Transport-Security" content="max-age=31536000; includeSubDomains; preload"><meta http-equiv="Cross-Origin-Opener-Policy" content="same-origin"><meta http-equiv="Cross-Origin-Embedder-Policy" content="require-corp"><link rel="icon" type="image/png" href="/assets/images/favicon.png"><link rel="apple-touch-icon" href="/assets/images/favicon.png"><title>Linux: Compilando e instalando o kernel em modo tradicional | william canin</title><meta name="generator" content="Jekyll v4.4.1"><meta property="og:title" content="Linux: Compilando e instalando o kernel em modo tradicional"><meta name="author" content="William C. Canin"><meta property="og:locale" content="pt"><meta name="description" content="Quando um usu√°rio Linux j√° est√° em um n√≠vel de usabilidade Linux a tempos, algo que ele procura saber, √© como compilar um kernel, e esse post falar√° exatamente sobre isso, mas uma compila√ß√£o sem usar kernel-package, a tradicional."><meta property="og:description" content="Quando um usu√°rio Linux j√° est√° em um n√≠vel de usabilidade Linux a tempos, algo que ele procura saber, √© como compilar um kernel, e esse post falar√° exatamente sobre isso, mas uma compila√ß√£o sem usar kernel-package, a tradicional."><link rel="canonical" href="https://williamcanin.github.io/blog/linux-compilando-e-instalando-o-kernel-em-modo-tradicional/"><meta property="og:url" content="https://williamcanin.github.io/blog/linux-compilando-e-instalando-o-kernel-em-modo-tradicional/"><meta property="og:site_name" content="william canin"><meta property="og:type" content="article"><meta property="article:published_time" content="2015-08-23T20:52:44+00:00"><meta name="twitter:card" content="summary"><meta property="twitter:title" content="Linux: Compilando e instalando o kernel em modo tradicional"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"William C. Canin"},"dateModified":"2015-08-23T20:52:44+00:00","datePublished":"2015-08-23T20:52:44+00:00","description":"Quando um usu√°rio Linux j√° est√° em um n√≠vel de usabilidade Linux a tempos, algo que ele procura saber, √© como compilar um kernel, e esse post falar√° exatamente sobre isso, mas uma compila√ß√£o sem usar kernel-package, a tradicional.","headline":"Linux: Compilando e instalando o kernel em modo tradicional","mainEntityOfPage":{"@type":"WebPage","@id":"https://williamcanin.github.io/blog/linux-compilando-e-instalando-o-kernel-em-modo-tradicional/"},"url":"https://williamcanin.github.io/blog/linux-compilando-e-instalando-o-kernel-em-modo-tradicional/"}</script><meta property="og:locale:alternate" content="en_US"><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=SUSE+Mono:ital,wght@0,100..800;1,100..800&display=swap" rel="stylesheet"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inconsolata:400,700&amp;display=swap"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"><link rel="stylesheet" href="/assets/vendor/bootstrap/css/bootstrap.min.css"><script>(function() {
      const savedTheme = localStorage.getItem('theme') || 'light';
      document.documentElement.setAttribute('data-theme', savedTheme);
    })();</script><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="/assets/css/custom.css"><link rel="alternate" type="application/atom+xml" title="william canin" href="/feed.xml"></head><body data-layout="post" data-terminal-enabled="true"><div class="default" style="max-width: 780px !important;"><div class="modal fade" id="avatarModal" tabindex="-1" aria-hidden="true"><div class="modal-dialog modal-dialog-centered"><div class="modal-content bg-transparent border-0 shadow-none"><div class="modal-body d-flex justify-content-center"><img id="modalAvatar" class="avatar-img" src="" alt=""></div></div></div></div><header class="container header"><div class="header-wrapper"><div class="row"><div class="col-sm-2 d-flex flex-column justify-content-end"><div class="container"><div class="row"><span>[¬†üè†¬†<a class="" href="/">home</a>¬†]</span></div></div></div><div class="col-sm-8 d-flex flex-column justify-content-end"><div class="container"><div class="row"><span class="title">william canin</span></div><div class="row"><small class="description">thoughts on programming, digital wellbeing, linux</small></div></div></div><div class="col-sm-2 d-flex justify-content-end avatar"><div class="avatar-wrapper"><div class="avatar-flipper light-theme avatar-flipper__open-true can-flip"><div class="avatar-card"><div class="avatar-front"><img id="avatarImgLight" class="avatar-img" src="/assets/images/wcanin_light.png" alt="william canin"></div><div class="avatar-back"><img class="avatar-img" src="/assets/images/wcanin_back.png" alt="william canin"></div></div></div><div class="avatar-flipper dark-theme avatar-flipper__open-true can-flip"><div class="avatar-card"><div class="avatar-front"><img id="avatarImgDark" class="avatar-img" src="/assets/images/wcanin_dark.png" alt="william canin"></div><div class="avatar-back"><img class="avatar-img" src="/assets/images/wcanin_back.png" alt="william canin"></div></div></div></div></div></div><div class="menu-separator"></div><div class="row"><div class="col-sm d-flex justify-content-center column-bottom"><span class="blog-menu">weblog¬†¬ª <a class="blog-menu__link" href="/blog/">üìù¬†posts</a><strong>¬†.¬†</strong>üîç¬†<a id="blog-search__btn" class="blog-menu__link" href="/blog/?search=open">search</a><strong>¬†.¬†</strong>üè∑Ô∏è¬†<a class="blog-menu__link" href="/blog/tags/">tags</a><strong>¬†.¬†</strong>üì∞¬†<a class="blog-menu__link" href="/feed.xml">feed</a><strong>¬†.¬†</strong></span></div></div><div class="row justify-content-end"><div class="col-sm-2 d-flex justify-content-end"><span id="toggle-theme"><i class="fa-solid fa-moon"></i></span></div></div></div></header><main class="content"><article class="container post" itemscope itemtype="http://schema.org/BlogPosting"><div class="row"><header class="post-header"><h1 class="post-title p-name" itemprop="name headline">¬ª¬†Linux: Compilando e instalando o kernel em modo tradicional</h1><div class="row post-meta"><div class="col-sm d-flex justify-content-start"><time class="dt-published" datetime="2015-08-23T20:52:44+00:00" itemprop="datePublished">23 Ago, 2015</time></div><div class="col-sm d-flex justify-content-end"><span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">autor:¬†William C. Canin</span></span></div><div class="post-reading_time">[¬†Leia em cerca de 27 minutos¬†]</div></div></header><div class="post-content e-content" itemprop="articleBody"><nav class="toc" id="toc" data-toc-selector=".post-content" data-toc-max-level="3" data-toc-scroll-offset="20"><div class="toc-head"><h2>√çndice</h2><button class="toc-toggle" aria-expanded="true" type="button">Fechar</button></div><div class="toc-list-wrapper"><ul class="toc-list" role="list"></ul><p class="toc-empty" style="display:none">No titles found. Remove TOC!</p></div></nav><script>(function () {
  const minLayoutWidth = 1830;

  const toc = document.getElementById('toc');
  if (toc) {
    const sentinel = document.createElement('div');
    toc.parentNode.insertBefore(sentinel, toc);

    function shouldApplyFixed() {
      return window.innerWidth > minLayoutWidth;
    }

    const observer = new IntersectionObserver(
      ([entry]) => {
        if (shouldApplyFixed()) {
          if (!entry.isIntersecting) {
            toc.classList.add('toc-fixed');
          } else {
            toc.classList.remove('toc-fixed');
          }
        } else {
          toc.classList.remove('toc-fixed');
        }
      },
      { threshold: 0 }
    );
    observer.observe(sentinel);

    window.addEventListener('resize', () => {
        if (!shouldApplyFixed()) {
            toc.classList.remove('toc-fixed');
        }
    });
  }

  function slugify(text) {
    if (!text) return '';
    return text.toString().toLowerCase().trim()
      .normalize('NFKD').replace(/[\u0300-\u036f]/g, '')
      .replace(/[^\w\s-]/g, '').replace(/\s+/g, '-').replace(/--+/g, '-');
  }

  function buildTOC(tocEl) {
    const selector = tocEl.dataset.tocSelector || '.post-content' || '.page-content';
    const maxLevel = parseInt(tocEl.dataset.tocMaxLevel || '3', 10);
    const offset = parseInt(tocEl.dataset.tocScrollOffset || '20', 10);
    const root = document.querySelector(selector);

    if (!root) {
      tocEl.querySelector('.toc-empty').textContent = `Content not found (${selector})`;
      tocEl.querySelector('.toc-empty').style.display = 'block';
      return;
    }

    const headings = Array.from(root.querySelectorAll(Array(maxLevel).fill(0).map((_, i) => `h${i + 1}`).join(',')))
      .filter(h => !tocEl.contains(h))
      .filter(h => parseInt(h.tagName.substring(1)) <= maxLevel);

    if (headings.length === 0) {
      tocEl.querySelector('.toc-empty').style.display = 'block';
      return;
    }

    const tocRoot = tocEl.querySelector('.toc-list');
    tocRoot.innerHTML = '';

    const idCounts = {};
    headings.forEach(h => {
      if (!h.id) {
        let id = slugify(h.textContent);
        if (!id) id = 'section';
        if (idCounts[id]) { idCounts[id] += 1; id = id + '-' + idCounts[id]; }
        else idCounts[id] = 1;
        h.id = id;
      }
    });

    // Build hierarchical tree
    const stack = [{ level: 0, ul: tocRoot }];
    headings.forEach((h, i) => {
      const level = parseInt(h.tagName.substring(1));
      const li = document.createElement('li');
      const a = document.createElement('a');
      a.href = '#' + h.id;
      a.textContent = h.textContent.trim();
      a.addEventListener('click', e => {
        e.preventDefault();
        window.scrollTo({ top: h.getBoundingClientRect().top + window.scrollY - offset, behavior: 'smooth' });
        history.replaceState(null, '', '#' + h.id);

        // // Clicking on the TOC menu closes the TOC
        // const wrapper = tocEl.querySelector('.toc-list-wrapper');
        // const toggle = tocEl.querySelector('.toc-toggle');
        // wrapper.style.display = 'none';
        // toggle.setAttribute('aria-expanded', 'false');
        // toggle.textContent = '{ { include.btn_show } }';
      });
      li.appendChild(a);

      while (stack.length > 1 && level <= stack[stack.length - 1].level) stack.pop();
      const parent = stack[stack.length - 1].ul;
      parent.appendChild(li);

      const next = headings[i + 1];
      if (next) {
        const nextLevel = parseInt(next.tagName.substring(1));
        if (nextLevel > level) {
          const newUl = document.createElement('ul');
          li.appendChild(newUl);
          stack.push({ level, ul: newUl });
        }
      }
    });

    // Active Highlight
    const links = tocRoot.querySelectorAll('a');
    function onScroll() {
      const fromTop = window.scrollY + offset + 1;
      let current = headings[0];
      for (let i = 0; i < headings.length; i++) {
        if (headings[i].offsetTop <= fromTop) current = headings[i];
      }
      links.forEach(l => l.classList.toggle('active', l.getAttribute('href') === '#' + current.id));
    }
    window.addEventListener('scroll', onScroll, { passive: true });
    onScroll();
  }

  document.addEventListener('DOMContentLoaded', function () {
    document.querySelectorAll('.toc').forEach(toc => {
      buildTOC(toc);
      const toggle = toc.querySelector('.toc-toggle');
      const wrapper = toc.querySelector('.toc-list-wrapper');

      wrapper.style.display = 'none';
      toggle.setAttribute('aria-expanded', 'false');
      toggle.textContent = 'Abrir';

      toggle.addEventListener('click', () => {
        const expanded = toggle.getAttribute('aria-expanded') === 'true';
        wrapper.style.display = expanded ? 'none' : 'block';
        toggle.setAttribute('aria-expanded', (!expanded).toString());
        toggle.textContent = expanded ? 'Abrir' : 'Fechar';
      });

      const tocTop = toc.offsetTop;

      function handleScrollFix() {
        if (window.innerWidth <= minLayoutWidth) {
          toc.classList.remove('fixed');
          toc.style.position = '';
          toc.style.top = '';
          toc.style.zIndex = '';
          toc.style.width = '';
          return;
        }

        const scrollTop = window.scrollY || document.documentElement.scrollTop;

        // Fixes pinning behavior in Chrome
        if (scrollTop >= tocTop) {
          toc.classList.add('fixed');
          toc.style.position = 'fixed';
          toc.style.top = '0';
          toc.style.zIndex = '9999';
          // toc.style.width = toc.offsetWidth + 'px';
        } else {
          toc.classList.remove('fixed');
          toc.style.position = '';
          toc.style.top = '';
          toc.style.width = '';
        }

        // // Automatically closes the TOC if it is open and scrolled to it.
        // const rect = toc.getBoundingClientRect();
        // if (rect.top <= 0 && toggle.getAttribute('aria-expanded') === 'true') {
        //   wrapper.style.display = 'none';
        //   toggle.setAttribute('aria-expanded', 'false');
        //   toggle.textContent = '{ { include.btn_show } }';
        // }
      }

      window.addEventListener('scroll', handleScrollFix, { passive: true });
      window.addEventListener('resize', handleScrollFix);
      handleScrollFix();
    });
  });
})();</script><h1 id="introdu√ß√£o">Introdu√ß√£o</h1><p>Quando um usu√°rio Linux j√° est√° em um n√≠vel de usabilidade Linux a tempos, algo que ele procura saber, √© como compilar um kernel, e esse post falar√° exatamente sobre isso, mas uma compila√ß√£o sem usar kernel-package, a tradicional.</p><p>Ter uma m√°quina customizada para ter um melhor desempenho e reconhecimento dos hardwares, √© a vontade de todos, independente de qual sistema operativo o indiv√≠duo usa. Usu√°rios linux, podem fazer essa customiza√ß√£o atrav√©s de uma ‚Äúrecompila√ß√£o‚Äù no kernel Linux (se voc√™ n√£o sabe o que √© um Kernel de Linux, veja <a href="https://www.kernel.org/category/about.html">aqui</a>).</p><p>Compilar o Kernel para sua m√°quina, pode lhe trazer melhorias, bom desempenho e deixando a inicializa√ß√£o mais veloz, por√©m, isso √© not√°vel quando se tem uma m√°quina de baixa pot√™ncia, pois compilar o kernel e utiliza-lo em uma m√°quina ‚Äútop‚Äù voc√™ pode n√£o perceber as altera√ß√µes de desempenho se comparando com o kernel gen√©rico, por ela ter uma gama de pot√™ncia e um kernel gen√©rico n√£o deixar√° ela lenta. Mas √© sempre recomendado deixar nosso S.O de acordo com nossos hardwares.</p><p>Caso queira compilar e deixar o n√∫cleo que o titio Linus Torvalds criou, enxuto na sua m√°quina, voc√™ precisar√° ter um bom conhecimento dos hardwares da mesma no qual vai compilar, pois se n√£o habilitar algo que a m√°quina necessita, pode n√£o carregar modulos, e sem driver expec√≠fico de algo que voc√™ use, por exemplo um driver da placa wireless.</p><p>Primeiro, n√£o tenha medo, pois se voc√™ n√£o habilitar um m√≥dulo que deveria ser habilitado, o m√°ximo que voc√™ vai perder √© o tempo da compila√ß√£o do kernel, que √© bem demorado dependendo da pot√™ncia de sua m√°quina. E outra, se de um <em>‚ÄúKernel Panic‚Äù</em> voc√™ pode iniciar seu Linux com o kernel gen√©rico de instala√ß√£o quando reiniciar a m√°quina na pr√≥xima vez, pois quando se instala um novo kernel, seja qual for seu gerenciador de boot (Grub ou Lilo), ele vai aparecer na inicializa√ß√£o juntamente com o Kernel gen√©rico/padr√£o de instala√ß√£o do Linux (desde que atualize o Grub/Lilo), ent√£o n√£o se preocupe. Medo devemos ter apenas do bicho pap√£o. <img class="emoji" title=":stuck_out_tongue_winking_eye:" alt=":stuck_out_tongue_winking_eye:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f61c.png" height="20" width="20"></p><p>Segundo, existe v√°rias formas para se compilar um kernel do Linux, v√°rias distribui√ß√£o Linux tem um jeito, porem irei fazer da forma mais tradicional nessa postagem, que <strong>SERVIR√Å</strong> para v√°rias distro. Mas enfim, vamos deixar de teoria e come√ßar logo essa aventura n√©? ‚ÄúSigam-me os interessados!‚Äù</p><blockquote><p>NOTA: Nessa postagem, observe bem os comandos que devem ser executados com root (superusu√°rio) e com usu√°rio normal. Para comandos a serem executados com root (superusu√°rio), destaquei an√∫ncio em vermelho.</p></blockquote><h1 id="pacotes-necess√°rios">Pacotes necess√°rios</h1><p>Antes de come√ßar precisamos verificar/instalar todos os pacotes necess√°rios para a compila√ß√£o do kernel. Ent√£o, instale esses pacotes de acordo com sua distro.</p><blockquote><p>Debian/Ubuntu:</p></blockquote><p><code class="language-plaintext highlighter-rouge">(Execute como root (superusu√°rio))</code></p><figure class="highlight"><pre><code class="language-bash" data-lang="bash">apt-get <span class="nb">install </span>libncurses5-dev libqt3-mt-dev libgtk2.0-dev libglib2.0-dev libglade2-dev</code></pre></figure><blockquote><p>Fedora:</p></blockquote><p><code class="language-plaintext highlighter-rouge">(Execute como root (superusu√°rio))</code></p><figure class="highlight"><pre><code class="language-bash" data-lang="bash">dnf <span class="nb">install </span>ncurses-devel qt3-devel libXi-devel gtk2-devel libglade2-devel</code></pre></figure><blockquote><p>Arch Linux:</p></blockquote><p><em>N√£o necessita instalar pacotes.</em></p><h1 id="criando-base-de-trabalho">Criando base de trabalho</h1><p>Ap√≥s a instala√ß√£o dos pacotes necess√°rios, vamos criar uma pasta chamada <strong>kernel</strong> no $HOME de seu us√∫ario e entrar nela. Essa pasta ser√° a base onde realizaramos o download do kernel e realizar todos os processos.</p><blockquote><p>NOTA: Existe v√°rios forma de configurar o kernel, uma delas √© no diret√≥rio /usr/src, o que muitas pessoas aderem essa forma, mais eu particulamente prefiro fazer tudo no $HOME, pois assim eu n√£o deixo sobrecarregado a minha parti√ß√£o do sistema (/) com os conte√∫dos compilados, mais isso √© relativo, de gosto pr√≥prio.</p></blockquote><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span><span class="nb">mkdir</span> <span class="nv">$HOME</span>/kernel <span class="o">&amp;&amp;</span> <span class="nb">cd</span> <span class="nv">$HOME</span>/kernel</code></pre></figure><h1 id="download-do-kernel">Download do kernel</h1><p>Agora teremos o privil√©gio de baixar o n√∫cleo que o titio Linus Torvalds criou, no site: <a href="https://www.kernel.org" target="_blank">kernel.org</a></p><p>Utilizarei o gerenciador de download <strong>wget</strong>, que pra mim √© o meio mais eficiente de realizar downloads no Linux, pois o mesmo te possibilita continuar o download com a op√ß√£o <strong>-c</strong> caso a energia acabe‚Ä¶voc√™ cancele sem querer o download‚Ä¶ a bateria do notebook exploda‚Ä¶ai j√° √© demais n√©?! V√° se benzer! ¬¨¬¨‚Äô</p><p>Para utilizar o download com o <strong>wget</strong>, fa√ßa no terminal:</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>wget https://www.kernel.org/pub/linux/kernel/v4.x/linux-<span class="o">{</span>VERS√ÉO<span class="o">}</span>.tar.xz</code></pre></figure><p>Onde {VERS√ÉO}, √© a vers√£o do kernel que voc√™ ir√° baixar. Vou supor que estaremos utilizando o kernel 4.1.6 de agora em diante nesse tutorial, que √© o kernel est√°vel mais recente no momento. Ent√£o ficaria assim:</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>wget https://www.kernel.org/pub/linux/kernel/v4.x/linux-4.1.6.tar.xz</code></pre></figure><blockquote><p>DICA: Como peguei o link de download do arquivo .tar.xz? Simples, clique com o bot√£o direito do mouse no bot√£o ‚Äúpequenino‚Äù de cor amarela no site https://www.kernel.org, e copie o <em>Endere√ßo de link</em>.</p></blockquote><p>Para saber mais sobre outras vers√µes de kernel, acesse: <a href="https://www.kernel.org/pub/linux/kernel/" target="_blank">kernel vers√µes</a></p><h1 id="descompactando-o-kernel">Descompactando o kernel</h1><p>Download realizado dentro da base de trabalho, agora vamos descompactar nosso ‚Äòouro‚Äô utilizando o <strong>tar</strong> e entrar dentro da pasta do nosso kernel:</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>xz <span class="nt">-cd</span> linux-4.1.6.tar.xz | <span class="nb">tar </span>xvf - <span class="o">&amp;&amp;</span> <span class="nb">cd </span>linux-4.1.6</code></pre></figure><h1 id="limpando-a-base">Limpando a base</h1><p>Esse comando ir√° remover qualquer arquivo compilado que contenha na nossa querida pasta do kernel e volta para o estado primitivo das configura√ß√µes, o que n√£o √© no nosso caso, pois n√£o compilamos nada ainda, mas √© sempre bom execut√°-lo para preven√ß√£o.</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>make mrproper <span class="o">&amp;&amp;</span> make clean</code></pre></figure><h1 id="configurando-o-kernel">Configurando o kernel</h1><h2 id="manualmente">Manualmente</h2><h3 id="reconhecendo-os-m√≥dulos-da-m√°quina">Reconhecendo os m√≥dulos da m√°quina</h3><p>A aventura come√ßa aqui! Vamos saber os m√≥dulos e driver que sua m√°quina necessita e posteriormente configurarmos esses m√≥dulos no kernel. Como foi dito no come√ßo, recompilar o kernel exige um certo reconhecimento de hardware da m√°quina, mas existem meios para facilitar isso, ent√£o irei dizer em partes.</p><p>Quando instalamos o Linux, o kernel da instala√ß√£o √© um kernel gen√©rico, ou seja, √© um kernel que funciona na maioria das m√°quinas, isso porque, v√°rios m√≥dulos de v√°rios tipo de driver s√£o incorporados. Ent√£o isso leva a entender que o kernel padr√£o da instala√ß√£o do Linux tem m√≥dulos que n√£o utilizamos. Esse √© um dos motivos de muitos querer recompilar o kernel, deixa-lo adapt√°vel para vossa m√°quina.</p><blockquote><p>Mas como deixar o kernel adapt√°vel √† m√°quina e saber os m√≥dulos necess√°rios para a mesma?</p></blockquote><p>R: Assim que instalamos o Linux e iniciamos o mesmo, os m√≥dulos que nossa m√°quina necessita s√£o carregados no boot(ou n√£o) para que o sistema funcione, correto? Com isso, existe 3 m√©todos (que pelo menos eu conhe√ßo) para sabermos os modulos que a m√°quina iniciou, necessita e est√° usando no momento.</p><h4 id="m√©todo-1"><strong>M√©todo 1</strong></h4><p>O primeiro m√©todo √© usar o comando:</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>lspci <span class="nt">-k</span></code></pre></figure><p>O que ir√° retornar os drivers <strong>PCI</strong> de sua m√°quina no t√≠tulo ‚ÄúKernel modules‚Äù. Exemplo do meu retorno:</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><table class="rouge-table"><tbody><tr>
<td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td>
<td class="code"><pre>00:00.0 Host bridge: Intel Corporation 2nd Generation Core Processor Family DRAM Controller <span class="o">(</span>rev 09<span class="o">)</span>
	Subsystem: Sony Corporation Device 908b
	Flags: bus master, fast devsel, latency 0
	Capabilities: &lt;access denied&gt;
<span class="nb">.</span>
<span class="nb">.</span> <span class="c"># Resto do counte√∫do retirado por ser extenso</span>
<span class="nb">.</span>

13:00.0 Ethernet controller: Realtek Semiconductor Co., Ltd. RTL8111/8168/8411 PCI Express Gigabit Ethernet Controller <span class="o">(</span>rev 06<span class="o">)</span>
	Subsystem: Sony Corporation Device 908b
	Flags: bus master, fast devsel, latency 0, IRQ 28
	I/O ports at 2000 <span class="o">[</span><span class="nv">size</span><span class="o">=</span>256]
	Memory at d1404000 <span class="o">(</span>64-bit, prefetchable<span class="o">)</span> <span class="o">[</span><span class="nv">size</span><span class="o">=</span>4K]
	Memory at d1400000 <span class="o">(</span>64-bit, prefetchable<span class="o">)</span> <span class="o">[</span><span class="nv">size</span><span class="o">=</span>16K]
	Capabilities: &lt;access denied&gt;
	Kernel driver <span class="k">in </span>use: r8169
	Kernel modules: r8169
</pre></td>
</tr></tbody></table></code></pre></figure><p>Com isso, voc√™ j√° saber√° alguns principais m√≥dulos que sua m√°quina necessita.</p><h4 id="m√©todo-2"><strong>M√©todo 2</strong></h4><p>Na verdade, esse segundo m√©todo √© um complemento do primeiro para identificar os demais hardwares da m√°quina, porem este lista perif√©ricos de USB.</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>lsusb <span class="nt">-t</span></code></pre></figure><p>Ir√° retornar os drivers e poss√≠veis m√≥dulos de entrada <strong>USB</strong> na vari√°vel ‚ÄúDriver‚Äù. Um exemplo:</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><table class="rouge-table"><tbody><tr>
<td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td>
<td class="code"><pre>/:  Bus 02.Port 1: Dev 1, <span class="nv">Class</span><span class="o">=</span>root_hub, <span class="nv">Driver</span><span class="o">=</span>ehci-pci/2p, 480M
    |__ Port 1: Dev 2, If 0, <span class="nv">Class</span><span class="o">=</span>Hub, <span class="nv">Driver</span><span class="o">=</span>hub/6p, 480M
/:  Bus 01.Port 1: Dev 1, <span class="nv">Class</span><span class="o">=</span>root_hub, <span class="nv">Driver</span><span class="o">=</span>ehci-pci/2p, 480M
    |__ Port 1: Dev 2, If 0, <span class="nv">Class</span><span class="o">=</span>Hub, <span class="nv">Driver</span><span class="o">=</span>hub/6p, 480M
        |__ Port 2: Dev 3, If 0, <span class="nv">Class</span><span class="o">=</span>Video, <span class="nv">Driver</span><span class="o">=</span>uvcvideo, 480M
        |__ Port 2: Dev 3, If 1, <span class="nv">Class</span><span class="o">=</span>Video, <span class="nv">Driver</span><span class="o">=</span>uvcvideo, 480M
        |__ Port 5: Dev 5, If 0, <span class="nv">Class</span><span class="o">=</span>Wireless, <span class="nv">Driver</span><span class="o">=</span>btusb, 12M
        |__ Port 5: Dev 5, If 1, <span class="nv">Class</span><span class="o">=</span>Wireless, <span class="nv">Driver</span><span class="o">=</span>btusb, 12M
</pre></td>
</tr></tbody></table></code></pre></figure><h4 id="m√©todo-3"><strong>M√©todo 3</strong></h4><p>Na terceira op√ß√£o, para listar os drivers/m√≥dulos que sua m√°quina carregou, √© usar o comando:</p><blockquote><p>NOTA: Ter√° que ter o programa <strong>hwinfo</strong>, instalado no linux. Instale de acordo com sua distro. Por exemplo: Debian/Ubuntu: # apt-get install hwinfo Fedora: # dnf install hwinfo Arch Linux: # pacman -S hwinfo</p></blockquote><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>hwinfo | <span class="nb">grep</span> <span class="nt">-i</span> module <span class="o">&amp;&amp;</span> hwinfo | <span class="nb">grep</span> <span class="nt">-i</span> snd</code></pre></figure><blockquote><p>NOTA: Observe que ser√° executado dois comandos unidos por ‚Äú&amp;&amp;‚Äù, voc√™ pode executa-los separadamente, para ter um retorno separado.</p></blockquote><p>Na sa√≠da desse comando, o que pertencer ao t√≠tulo <strong>‚ÄúDriver Modules‚Äù</strong> e tudo que come√ßar com <strong>‚Äúsnd_‚Äú</strong> ser√° um driver que sua m√°quina possivelmente estar√° usando, necessita ou te≈ï√° que ser carregado no kernel.</p><p>Para mais informa√ß√µes de comandos, use: <strong>$ man hwinfo</strong>.</p><hr><p>Tem ainda o <strong>lshw</strong> que tamb√©m lista seu hardware:</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>lshw | <span class="nb">grep</span> <span class="nt">-i</span> driver</code></pre></figure><p>Nesse retorno, o t√≠tulo que est√° como ‚Äúdriver‚Äù ser√° o importante, pois nele conter√° os drivers listados. O pacote <strong>lshw</strong>, tamb√©m te possibilita gravar em forma de HTML as informa√ß√µes de sua m√°quina. Para salvar todas informa√ß√µes do seu hardware em HTML, use o comando:</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>lshw <span class="nt">-html</span> <span class="o">&gt;</span> <span class="nv">$HOME</span>/harware-info.html</code></pre></figure><p>Para mais informa√ß√µes de comandos, use: <strong>$ man lshw</strong>.</p><p>Se n√£o quiser instalar pacotes que fa√ßa esse retorno de harware para voc√™, voc√™ pode utilizar os pr√≥prios pacotes/arquivos existentes que vem por padr√£o nas distros, que tamb√©m lhe tr√°s informa√ß√µes ricas do hardware. Executando os comandos abaixo ter√° muitas informa√ß√µes:</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>lscpu
<span class="nv">$ </span><span class="nb">cat</span> /proc/cpuinfo
<span class="c"># dmidecode</span></code></pre></figure><p>Sendo que o √∫ltimo, voc√™ deve instalar o pacote <strong>dmidecode</strong> e execut√°-lo como root/superusu√°rio.</p><h3 id="iniciando-a-configura√ß√£o">Iniciando a configura√ß√£o</h3><p>Agora que j√° sabe 3 m√©todos, execute o comando abaixo para entrar no menu de configura√ß√£o do kernel do Linux e saber como pesquisar os m√≥dulos para sua m√°quina de acordo com os m√©todos que voc√™ utilizou acima.</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>make menuconfig</code></pre></figure><blockquote><p>NOTA: Existe outros tipo de layouts de menu, porem esse √© o padr√£o e mais utilizado por todos. √â menu bem intuitivo, f√°cil de manusear, onde as setas s√£o as respons√°veis por direcionar o foco. Mas se quiser tem o <strong>make nconfig, make config, make gconfig e make xconfig</strong>.</p></blockquote><h3 id="manuseio-para-o-make-menuconfig">Manuseio para o ‚Äúmake menuconfig‚Äù</h3><p>No menu de configura√ß√£o kernel voc√™ ir√° se deparar com configura√ß√µes desse tipo: [ ] , [ * ], [ M ], &lt; &gt;, -*-.</p><p><strong>Legenda:</strong></p><p>[ ] indica que o m√≥dulo(s) est√° desabilitado.</p><p>[ * ] indica que o(s) m√≥dulo est√° habilitado para ser incorporado ao kernel na compila√ß√£o.</p><p>[M] indica que o(s) m√≥dulo(s) ficar√° habilitado mas n√£o incorporado ao kernel.</p><p>-*- indica que o m√≥dulo dever ser incorporado ao kernel na compila√ß√£o, essa op√ß√£o n√£o d√° pra alterar.</p><p>Outro recurso importante √© a pesquisa de m√≥dulos/driver no menu (menuconfig) de configura√ß√£o do kernel, a qualquer lugar que esteje, voc√™ apertando a tecla de barra do seu teclado (/), ir√° abrir uma janela dialog de pesquisa. Por exemplo:</p><figure class="img-include-wrapper img-include-align-center" style="width: autopx;"><img src="/assets/images/posts/search-kernel-linux.png" alt="search-kernel-linux" style="display:block; width:100%; height: auto; border-radius: 2px; border: 2px solid #000;"><figcaption class="img-include-caption">kernel search</figcaption></figure><p>Nessa dialog, voc√™ coloca um m√≥dulo/driver que foi listado com os comandos dos M√©todos 1, 2 ou 3, e assim vai pesquisando os drivers para sua m√°quina no kernel. No exemplo abaixo, pesquisei o driver <em>‚Äúr8169</em>‚Äù que listou no comando <em>$ lspci -k</em>. Veja:</p><figure class="img-include-wrapper img-include-align-center" style="width: autopx;"><img src="/assets/images/posts/search-kernel-linux-return.png" alt="search-kernel-linux-return" style="display:block; width:100%; height: auto; border-radius: 2px; border: 2px solid #000;"><figcaption class="img-include-caption">kernel search return</figcaption></figure><p>A primeira observa√ß√£o, √© a instru√ß√£o <em>‚ÄúSymbol‚Äù</em>, que ir√° dizer o nome do m√≥dulo e no final ir√° dizer se o mesmo est√° como ‚ÄúM, y ou n‚Äù (sendo que ‚Äúy‚Äù, √© o mesmo que asterisco[ * ] no menu de configura√ß√£o do kernel). A segunda observa√ß√£o √© <em>‚ÄúPrompt‚Äù</em>, que ser√° o nome do m√≥dulo que estar√° imprimido no terminal. A terceira observa√ß√£o est√° em <em>‚ÄúLocation‚Äù</em>, √© o local onde esse m√≥dulo se encontra no menu do kernel. Entre nesse diret√≥rio e configure o m√≥dulo para [M], [ * ] ou [ ].</p><p><strong>Lembrando!</strong> Se o m√≥dulo que voc√™ colocou na pesquisa obtido nos M√©todos 1, 2 ou 3, retornou algum resultado diferente de <em>‚ÄúNo matches found‚Äù</em>, √© bem prov√°vel que a m√°quina necessite desse m√≥dulo.</p><p>Agora √© s√≥ salvar toda configura√ß√£o no ‚Äúbot√£o‚Äù Save, e com isso ir√° criar um arquivo oculto chamado <strong>.config</strong>.</p><p><em>Guarde esse arquivo oculto ‚Ä¶</em></p><p><em>‚Ä¶pois ele √© o conte√∫do de toda essa <strike>trabalhosa pesquisa e</strike> configura√ß√£o que voc√™ teve que fazer no kernel para sua m√°quina.</em></p><h2 id="automaticamente">Automaticamente</h2><p>Esse √© o mais r√°pido meio de configurar o kernel de acordo com os m√≥dulos que sua m√°quina necessita. Voc√™ n√£o precisa fazer pesquisa de todos m√≥dulos que sua m√°quina precisa no menu de configura√ß√£o do kernel. Esse meio de configurar, ir√° usar <em>lsmod</em> para examinar quais m√≥dulos est√£o atualmente em uso, e, em seguida, configurar/criar o seu <strong>‚Äú.config‚Äù</strong>. O resultado √© um tempo de compila√ß√£o mais curto e um kernel espec√≠fico para o seu hardware. Porem, deve-se executar a partir de uma m√°quina que esteja usando um kernel gen√©rico, para assim, trabalhar com os drivers para seu hardware carregados como m√≥dulos. Se n√£o utilizar uma m√°quina iniciada com um kernel gen√©rico, o <em>lsmod</em> n√£o ir√° identificar os drivers embutidos no kernel. Ent√£o se estiver preparado, fa√ßa os seguintes procedimentos abaixo de acordo com sua distro Linux:</p><h3 id="carregando-config-gen√©rico">Carregando .config gen√©rico.</h3><p>Fedora/Debian/Ubuntu:</p><p><code class="language-plaintext highlighter-rouge">(Execute como root (superusu√°rio))</code></p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">cp</span> /boot/config-<span class="si">$(</span><span class="nb">uname</span> <span class="nt">-r</span><span class="si">)</span> .config</code></pre></figure><p>Arch Linux:</p><p><code class="language-plaintext highlighter-rouge">(Execute como root (superusu√°rio))</code></p><figure class="highlight"><pre><code class="language-bash" data-lang="bash">zcat /proc/config.gz <span class="o">&gt;</span> .config</code></pre></figure><h3 id="entrando-no-menu-do-kernel">Entrando no menu do kernel</h3><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>make menuconfig</code></pre></figure><p>V√° no bot√£o de Salvar e salve. Sai do menu do kernel.</p><h3 id="carregando-drivers-a-partir-do-lsmod">Carregando drivers a partir do lsmod</h3><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>make localmodconfig</code></pre></figure><p>Pronto. Seu <strong>‚Äò.config‚Äô</strong> j√° foi criado ap√≥s esse comando. Por√©m, se depois desse comando aparecer algo como‚Ä¶</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash">module btintel did not have configs CONFIG_BT_INTEL</code></pre></figure><p>‚Ä¶quer dizer que esse m√≥dulo/driver (btintel) n√£o est√° configurado, ent√£o voc√™ deve configura-lo no kernel. Abra o menu do kernel (make menuconfig) e pesquisa por esse driver (como foi dito na forma manualmente l√° em cima) e habilite-o. Fa√ßa isso para todos que aparecer com uma mensagem parecida com est√°. Depois habilite com [M] ou [ * ], e salve.</p><p>Essa forma de configurar √© mam√£o com a√ßucar n√©?, porem, irei abrir um parenteses grande:</p><blockquote><p><strong>(Voc√™ deve plugar na entrada USB dispositivos como: pendrive, HD Externos, mouse ou impressora. Se usar algum programa de criptografia que faz montagem de dispositivos, tamb√©m deve estar habilitado para reconhecer o driver de CRYPT. Se voc√™ usa Steam, inicie o aplicativo pois ele usa o driver HID. Antes de criar o arquivo ‚Äú.config‚Äù, o comando ‚Äòlocalmodconfig‚Äô verifica as entradas que est√° sendo utilizadas e poss√≠veis programas que est√£o utilizando (ou necessitam) de um determinado driver para sua m√°quina. Essas foram algumas necessidades que precisei ‚Äòstartar‚Äô no meu harware, por√©m, existem v√°rios aplicativos que ir√° usar algo do seu harware, cabe a voc√™ saber quais ir√£o usar, por isso, saber do seu harware e saber o que habilitar no kernel, √© fundamental sim, mesmo utilizando a op√ß√£o automatizada de configurar o ‚Äú.config‚Äù. M√≥dulos de USB, n√£o s√£o habilitados por padr√£o no boot/inicializa√ß√£o, e sim apenas quando est√£o em uso)</strong>.</p></blockquote><p>Outra forma de configurar o ‚Äú.config‚Äù com o <strong>localmodconfig</strong>, √© usar um par√¢metro para carregar um lsmod em arquivo, ou seja, primeiro voc√™ cria um arquivo com o comando:</p><p><code class="language-plaintext highlighter-rouge">(Execute como root (superusu√°rio))</code></p><figure class="highlight"><pre><code class="language-bash" data-lang="bash">lsmod <span class="o">&gt;</span> /tmp/lsmod</code></pre></figure><p>‚Ä¶ir√° inserir todos os m√≥dulos que sua m√°quina esta usando no arquivo <strong>‚Äú/tmp/lsmod‚Äù</strong> (porem, tamb√©m deve-se plugar todos os tipos de perif√©ricos que voc√™ usa (Pendrives, HD Externo, Impressora..etc)).</p><p>Ap√≥s gerar o arquivo, j√° pode usar-lo com o <strong>‚Äúlocalmodconfig‚Äù</strong>:</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>make <span class="nv">LSMOD</span><span class="o">=</span>/tmp/lsmod localmodconfig</code></pre></figure><p>A vantagem de usar um arquivo gerado com o <strong>‚Äúlsmod‚Äù</strong> para armazenar seus m√≥dulos carregados, √© que voc√™ plugue os perif√©ricos (Pendrives, Impressora..etc) apenas uma √∫nica vez, n√£o necessitado de plugar toda vez que for usar o <strong>‚Äúlocamodconfig‚Äù</strong>, ou seja, j√° ter√° seus m√≥dulos carregados em um arquivo. Apenas guarde-o!</p><blockquote><p>NOTA 1: O diret√≥rio para gerar o arquivo atrav√©s do ‚Äúlsmod‚Äù, √© opcional, n√£o necessita ser em ‚Äú/tmp‚Äù.Deve usar ‚Äúmake LSMOD=‚Äù com letras maiusculas no LSMOD.</p></blockquote><blockquote><p>NOTA 2: Se ap√≥s executar o comando: $ make localmodconfig ou $ make LSMOD=/tmp/lsmod localmodconfig , e vir uma s√©rie de perguntas, apenas digite ‚ÄúY‚Äùpara todas elas caso voc√™ tenha d√∫vidas.</p></blockquote><blockquote><p>Observa√ß√£o: O arquivo contendo os m√≥dulos, criado atrav√©s do comando ** lsmod<strong>, serviu apenas para a distribui√ß√£o que eu gerei ele. Exemplo: Criei o arquivo no Ubuntu, e n√£o funcionou no Arch Linux quando o incorporei no **‚Äúmake LSMOD‚Äù</strong>.</p></blockquote><hr><p>Agora que j√° sabe os ‚Äúmacetes‚Äù de como listar os drivers necess√°rios para sua m√°quina e como configurar um kernel adaptando para a mesma, fica a seu crit√©rio qual utilizar, op√ß√£o ‚Äúmanualmente‚Äù (atrav√©s do menuconfig) ou a op√ß√£o ‚Äúautomaticamente‚Äù (usando o localmodconfig). Eu sempre usei a op√ß√£o ‚Äúautom√°tica‚Äù de configurar o kernel, nunca tive problemas. Agora se quer se aventurar e conhecer bem as op√ß√µes no menu de configura√ß√µes do kernel, fa√ßa a configura√ß√£o ‚Äúmanualmente‚Äù.</p><blockquote><p>NOTA: Existe outras formas de configurar o kernel, voc√™ pode saber lendo o arquivo ‚ÄúREADME‚Äù contido no kernel, na parte ‚ÄúCONFIGURING the kernel‚Äù.</p></blockquote><h1 id="finalizando-as-configura√ß√µes">Finalizando as configura√ß√µes</h1><p>Para terminar as configura√ß√µes do kernel, seja qual forma voc√™ preferiu seguir, ‚Äúmanualmente‚Äù ou ‚Äúautomaticamente‚Äù, voc√™ tem que fazer uma configura√ß√£o recomendada, para que n√£o aconte√ßa ‚Äúcagada‚Äù futuramente, porque se esquecer de fazer essa configura√ß√£o, voc√™ pode substituir um kernel j√° existente por essa nova compila√ß√£o. Essa configura√ß√£o √© nada mais e nada a menos que o <em>‚Äúsobrenome‚Äù</em> (vou chamar assim) que seu kernel compilado ir√° receber. Por padr√£o, o kernel j√° ter√° um ‚Äúnome‚Äù, que √© a vers√£o do mesmo ap√≥s compilar, mas √© bom colocar um ‚Äúsobrenome‚Äù para o kernel, afinal, qual filho n√£o tem sobrenome nesse mundo, hein?! KKK ;)</p><p>Esse passo √© feito atrav√©s do submenu <strong>‚ÄúLocal version‚Äù</strong> do kernel, que tem um significado de ‚Äúcorda extra para o final da sua vers√£o‚Äù. Para isso, entre no menu de configura√ß√£o do kernel (caso n√£o esteja nele) com o comando:</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>make menuconfig</code></pre></figure><p>Com o menu aberto, entre no seguinte local [A tecla ‚ÄòEnter‚Äô seleciona o local]:</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash">-&gt; General setup
    -&gt; Local version - append to kernel release</code></pre></figure><p>Na nova janela de dialog utilize esse formato:</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nt">-ARCH-RC</span><span class="o">[</span>N√öMERO]</code></pre></figure><p>Onde:</p><p>ARCH: Arquitetura do seu Linux (x86_64/i386, amd64..etc) RC: De release candidate. [N√öMERO]: O numero de vezes que a vers√£o desse kernel foi compilado.</p><p>Voc√™ pode colocar o que quiser, porem eu acho essa forma mais compreens√≠vel de se entender. Um exemplo de como poderia ficar:</p><blockquote><p>-x86_64-RC1</p></blockquote><p>Note que tem um tra√ßo no come√ßo, ser√° a separa√ß√£o da vers√£o do kernel(nome) com a arquitetura e compila√ß√£o (sobrenome), pois quando voc√™ digitar <strong>uname -a</strong> no terminal, ir√° aparecer algo parecido com isso:</p><blockquote><p>Linux 4.1.6-x86_64-RC1</p></blockquote><p>Ap√≥s fazer essa configura√ß√£o, salve no bot√£o ‚ÄòSave‚Äô e saia do <em>menuconfig</em>.</p><h1 id="compilando-o-kernel">Compilando o Kernel</h1><p>Agora √© a t√£o sonada hora de todos! Ap√≥s realizar a dedicada configura√ß√£o do kernel (dedicada para quem fez a configura√ß√£o manualmente, claro rs) voc√™ vai poder fazer aquele ‚Äúdescansinho‚Äù‚Ä¶ dar uma longa caminhada, viajar para Fernando de Noronha (esse √∫ltimo descanso √© mentira! :D), porque dependendo da sua m√°quina, esse processo demora entre 1 hora ou mais (e isso n√£o √© mentira <img class="emoji" title=":frowning:" alt=":frowning:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f626.png" height="20" width="20">). Ent√£o amigo, execute o comando abaixo e v√° procurar algo para se distrair:</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash">make <span class="nt">-j</span><span class="o">[</span>NUMERO DE N√öCLEO DO PROCESSADOR +1] <span class="o">&amp;&amp;</span> make <span class="nt">-j</span><span class="o">[</span>NUMERO DE N√öCLEO DO PROCESSADOR +1] modules</code></pre></figure><blockquote><p><strong>NOTA:</strong> Onde est√° [NUMERO DE N√öCLEO DO PROCESSADOR +1] √© o numero de n√∫cleos do processsador da m√°quina + 1. Por exemplo, se a m√°quina possui 2(dois) n√∫cleos de processadores ent√£o ficar√° 2+1=3. Exemplo: <strong>‚Äúmake -j3 &amp;&amp; make -j3 modules‚Äù</strong>. Com isso, voc√™ far√° sua m√°quina compilar o kernel com mais pot√™ncia, o que diminuir√° o tempo de compila√ß√£o (e seu ‚Äúdescansinho‚Äù ser√° mais r√°pido rs). Caso voc√™ n√£o sa√≠ba sobre quantos n√∫cleos tem seu processador, execute o comando <strong>lscpu</strong> e veja algo como N√∫cleos. Por√©m, recomendo que utilize o comando: <strong>$ make &amp;&amp; make modules</strong>, sem jobs(-j).</p></blockquote><h1 id="instalando-os-m√≥dulos-compilados">Instalando os m√≥dulos compilados</h1><p>Iae indiv√≠duo! J√° voltou do seu outro afazer? Vamos instalar esses m√≥dulos? Pois de agora em diante os passos s√£o ‚Äúrapidinhos‚Äù.</p><blockquote><p>NOTA: OS m√≥dulos ser√£o instalados na pasta <strong>‚Äú/lib/modules/{VERS√ÉO-DO-KERNEL} -ARCH-RC[N√öMERO]‚Äù</strong> (Exemplo: /lib/modules/4.1.6-x86_64-RC1). Deve-se saber que os m√≥dulos por padr√£o, ser√£o constru√≠dos nessa pasta com informa√ß√µes de depura√ß√£o, o que acaba deixando a pasta com um tamanho de aproximadamente 2GB. Para reduzir esse tamanho, voc√™ pode usar a vari√°vel de ambiente <strong>INSTALL_MOD_STRIP</strong> com o valor de 1(um). Assim, a instala√ß√£o dos m√≥dulos em <strong>‚Äú/lib/modules/4.1.6-x86_64-RC1‚Äù</strong>, ser√° compactada. Por√©m, √© algo opcional.</p></blockquote><p><code class="language-plaintext highlighter-rouge">IMPORTANTE! Os comandos do "Instalando os m√≥dulos compilados" dever√£o que ser executados como root (superusu√°rio).</code></p><h2 id="instala√ß√£o-normal">Instala√ß√£o normal</h2><p><strong>Usando n√∫cleos do processador:</strong></p><figure class="highlight"><pre><code class="language-bash" data-lang="bash">make <span class="nt">-j</span><span class="o">[</span>NUMERO DE N√öCLEO DO PROCESSADOR +1] modules_install</code></pre></figure><p><strong>N√ÉO usando n√∫cleos do processador:</strong></p><figure class="highlight"><pre><code class="language-bash" data-lang="bash">make modules_install</code></pre></figure><h2 id="instala√ß√£o-compactada">Instala√ß√£o compactada</h2><p><strong>Usando n√∫cleos do processador:</strong></p><figure class="highlight"><pre><code class="language-bash" data-lang="bash">make <span class="nt">-j</span><span class="o">[</span>NUMERO DE N√öCLEO DO PROCESSADOR +1] <span class="nv">INSTALL_MOD_STRIP</span><span class="o">=</span>1 modules_install</code></pre></figure><p><strong>N√ÉO usando n√∫cleos do processador:</strong></p><figure class="highlight"><pre><code class="language-bash" data-lang="bash">make <span class="nv">INSTALL_MOD_STRIP</span><span class="o">=</span>1 modules_install</code></pre></figure><h1 id="copiando-o-kernel-para-o-boot">Copiando o kernel para o /boot</h1><p>Kernel compilado, m√≥dulos instalados‚Ä¶ agora vamos copiar o <strong>‚ÄúbzImage‚Äù</strong> gerado para a pasta de onde come√ßa a iniciar todo o nosso sistema operativo Linux, que √© a pasta <strong>‚Äú/boot‚Äù</strong>.</p><p><code class="language-plaintext highlighter-rouge">IMPORTANTE! O comando do "Copiando o kernel para o /boot" dever√£o que ser executados como root (superusu√°rio).</code></p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">cp</span> <span class="nt">-v</span> <span class="nb">arch</span>/x86/boot/bzImage /boot/vmlinuz-<span class="o">{</span>VERSION<span class="o">}</span>-<span class="o">{</span>ARCH<span class="o">}</span>-<span class="o">{</span>RC<span class="o">}</span></code></pre></figure><p>Lembra do ‚Äúnome‚Äù, que √© a vers√£o do nosso kernel, e o ‚Äúsobrenome‚Äù (arquitetura+numero da compila√ß√£o) que foi inserido ao kernel em <strong>‚ÄúLocal version‚Äù</strong> no menuconfig? Ent√£o, use eles no <em>vmlinuz-{VERSION}-{ARCH}-{RC}</em>, por exemplo:</p><blockquote><p>vmlinuz-4.1.6-x86_64-RC1</p></blockquote><h1 id="criando-a-ramdisk">Criando a RAMDISK</h1><p>Nesse passo vai depender de sua distribui√ß√£o Linux. Use um dos comandos abaixo para cria√ß√£o da RAMDISK:</p><p><code class="language-plaintext highlighter-rouge">IMPORTANTE! O comando do "Criando a RAMDISK" dever√£o que ser executados como root (superusu√°rio)..</code></p><p>Para voc√™, usu√°rio de <a href="https://www.archlinux.org/" target="_blank">Arch Linux</a></p><figure class="highlight"><pre><code class="language-bash" data-lang="bash">mkinitcpio <span class="nt">-k</span> <span class="o">{</span>VERSION<span class="o">}</span>-<span class="o">{</span>ARCH<span class="o">}</span>-<span class="o">{</span>RC<span class="o">}</span> <span class="nt">-c</span> /etc/mkinitcpio.conf <span class="nt">-g</span> /boot/initramfs-<span class="o">{</span>VERSION<span class="o">}</span>-<span class="o">{</span>ARCH<span class="o">}</span>-<span class="o">{</span>RC<span class="o">}</span>.img</code></pre></figure><p>Se voc√™ usa <a href="http://debian.org" target="_blank">Debian</a>/<a href="http://www.ubuntu.com/" target="_blank">Ubuntu</a>, fa√ßa assim:</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash">mkinitramfs <span class="nt">-o</span> /boot/initramfs-<span class="o">{</span>VERSION<span class="o">}</span>-<span class="o">{</span>ARCH<span class="o">}</span>-<span class="o">{</span>RC<span class="o">}</span>.img /lib/modules/<span class="o">{</span>VERSION<span class="o">}</span>-<span class="o">{</span>ARCH<span class="o">}</span>-<span class="o">{</span>RC<span class="o">}</span></code></pre></figure><p>ou</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash">update-initramfs <span class="nt">-c</span> <span class="nt">-k</span> <span class="o">{</span>VERSION<span class="o">}</span>-<span class="o">{</span>ARCH<span class="o">}</span>-<span class="o">{</span>RC<span class="o">}</span></code></pre></figure><p>Para usu√°rio <strike>"Fedorendo" (haha brincadeira)</strike> <a href="https://getfedora.org/" target="_blank">Fedora</a>, fa√ßa assim:</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash">dracut /boot/initramfs-<span class="o">{</span>VERSION<span class="o">}</span>-<span class="o">{</span>ARCH<span class="o">}</span>-<span class="o">{</span>RC<span class="o">}</span>.img /lib/modules/<span class="o">{</span>VERSION<span class="o">}</span>-<span class="o">{</span>ARCH<span class="o">}</span>-<span class="o">{</span>RC<span class="o">}</span></code></pre></figure><h1 id="copiando-o-systemmap-e-config-para-o-boot">Copiando o ‚ÄúSystem.map‚Äù e ‚Äú.config‚Äù para o /boot</h1><p><code class="language-plaintext highlighter-rouge">IMPORTANTE! O comando do "Copiando o "System.map" e ".config" para o /boot" dever√£o que ser executados como root (superusu√°rio).</code></p><p>O arquivo <strong>System.map</strong> n√£o √© necess√°rio para inicializa√ß√£o do Linux. √â um tipo de <em>‚Äúlista telef√¥nica‚Äù</em> de fun√ß√µes em uma constru√ß√£o particular de um kernel. O <strong>.config</strong> tamb√©m n√£o √© necess√°rio para iniciar o Linux, mas mesmo assim iremos copiar ambos para a pasta <strong>/boot</strong> para fins de organiza√ß√£o e poss√≠veis informa√ß√µes futuras. Para isso fa√ßa:</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">cp </span>System.map /boot/System.map-<span class="o">{</span>VERSION<span class="o">}</span>-<span class="o">{</span>ARCH<span class="o">}</span>-<span class="o">{</span>RC<span class="o">}</span>
<span class="nb">cp</span> .config /boot/config-<span class="o">{</span>VERSION<span class="o">}</span>-<span class="o">{</span>ARCH<span class="o">}</span>-<span class="o">{</span>RC<span class="o">}</span></code></pre></figure><h1 id="atualizando-o-gerenciador-de-boot">Atualizando o gerenciador de boot</h1><p><code class="language-plaintext highlighter-rouge">IMPORTANTE! O comando do "Atualizando o gerenciador de boot" dever√£o que ser executados como root (superusu√°rio).</code></p><p>Ap√≥s todo o processo, nesse passo voc√™ ter√° que atualizar o gerenciador de boot, p√≥is s√≥ assim, a nova imagem de boot do kernel compilado ser√° reconheciada ao inciarmos a m√°quina. Suponho que seu gerenciador de boot seja Grub. Ent√£o fa√ßa assim para atualizar:</p><p>Debian/Ubuntu:</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash">update-grub <span class="o">&amp;&amp;</span> grub-install /dev/sda</code></pre></figure><p>Fedora:</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash">grub2-mkconfig <span class="nt">-o</span> /boot/grub2/grub.cfg <span class="o">&amp;&amp;</span> grub-install /dev/sda</code></pre></figure><p>Arch Linux</p><figure class="highlight"><pre><code class="language-bash" data-lang="bash">grub-mkconfig <span class="nt">-o</span> /boot/grub/grub.cfg <span class="o">&amp;&amp;</span> grub-install /dev/sda</code></pre></figure><blockquote><p>NOTA: Se sua distribui√ß√£o usa o LILO como gerenciador de boot, n√£o fa√ßa os ‚ÄúCopiando o kernel para o /boot‚Äù, ‚ÄúCriando a RAMDISK‚Äù e ‚ÄúAtualizando o gerenciador de boot‚Äù. Ap√≥s compilar o kernel utilize o comando abaixo para realizar a instala√ß√£o atrav√©s do pr√≥prio script de instala√ß√£o do kernel:</p></blockquote><figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="se">\#</span> make <span class="nb">install</span></code></pre></figure><h1 id="conclus√£o">Conclus√£o</h1><p>Ufa! Terminou, e eu fico por aqui! <img class="emoji" title=":satisfied:" alt=":satisfied:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f606.png" height="20" width="20">. Espero que sua compila√ß√£o do kernel tenha sido um sucesso, mas caso n√£o tenha, n√£o desista, refa√ßa os processos e procure saber sobre o problema e sobre o hardware da m√°quina se poss√≠vel, pois o mundo Linux √© muito prazeroso de se aprender. At√© pr√≥xima leitor!</p></div><div class="row post-tags"><ul class="tag-list"><strong>[ tags ]:</strong>¬†¬†<li class="tag-list__item"><a class="tag-list__link" href="/blog/tags/compile">compile</a></li><strong>¬†¬†.¬†¬†</strong><li class="tag-list__item"><a class="tag-list__link" href="/blog/tags/kernel">kernel</a></li><strong>¬†¬†.¬†¬†</strong><li class="tag-list__item"><a class="tag-list__link" href="/blog/tags/linux">linux</a></li><strong>¬†¬†.¬†¬†</strong></ul></div></div><div class="post-end text-center">/¬†/¬†/¬†/¬†¬†end of post¬†¬†/¬†/¬†/¬†/</div><div class="row comments"><h1 class="comments-title">[¬†coment√°rios¬†]</h1><div class="row comments-content"><script src="https://giscus.app/client.js" data-repo="williamcanin/williamcanin.github.io" data-repo-id="MDEwOlJlcG9zaXRvcnk0MDMyOTUzOQ==" data-category-id="DIC_kwDOAmdhQ84CwLFu" data-mapping="pathname" data-strict="0" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="bottom" data-theme="noborder_light" data-lang="pt" crossorigin="anonymous" async></script></div></div><div class="row related-posts"><h3 class="related-posts-title">[¬†postagens relacionadas¬†]</h3><ul class="related-posts-list"><li class="related-posts-list__item"><span class="related-posts-list__meta">21 Jun, 2018</span>¬†¬ª¬†<a class="related-posts-list__link" href="/blog/instalando-python-automaticamente-em-qualquer-sistema-linux/">Instalando Python tarball em qualquer sistema Linux.</a></li><li class="related-posts-list__item"><span class="related-posts-list__meta">16 Out, 2017</span>¬†¬ª¬†<a class="related-posts-list__link" href="/blog/criptografando-a-particao-home-no-linux/">Criptografando a parti√ß√£o HOME no Linux</a></li><li class="related-posts-list__item"><span class="related-posts-list__meta">26 Jul, 2015</span>¬†¬ª¬†<a class="related-posts-list__link" href="/blog/linux-boot-a-start-job-is-running-for-dev-disk-by/">Linux Boot: A start job is running for dev-disk-by</a></li><li class="related-posts-list__item"><span class="related-posts-list__meta">14 Mai, 2015</span>¬†¬ª¬†<a class="related-posts-list__link" href="/blog/compilando-e-configurando-squid-transparent/">Compilando e configurando Squid</a></li><li class="related-posts-list__item"><span class="related-posts-list__meta">29 Abr, 2015</span>¬†¬ª¬†<a class="related-posts-list__link" href="/blog/arquivos-de-execucao-no-linux/">Arquivos de execu√ß√£o no Linux</a></li></ul></div></article></main><footer class="container-fluid fixed-bottom footer"><div class="row top"><div class="col-md d-flex justify-content-end"><a id="top-link" class="top-link" href="#top">^</a></div></div><div class="row footer-wrapper"><div class="col-md footer-copyright-wrap"><div class="footer-copyright">¬©¬†william canin¬†2015-2025¬†-¬†Todos os direitos reservados¬†|¬†<a href="/licenses/">Licen√ßas</a></div></div><div class="col-md footer-message-wrap"><div class="footer-message">Doing stuff on the web since 2007</div></div><div class="col-md footer-made-by-wrap"><div class="footer-made-by">Using the <a href="https://github.com/williamcanin/rawfeed" target="_blank" rel="noopener noreferrer">rawfeed</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener noreferrer">Jekyll</a>.</div></div></div></footer></div></body><script src="/assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script><script>window.giscusThemes = {
      light: "noborder_light",
      dark: "noborder_gray"
    };</script><script src="/assets/js/default.js"></script><script src="/assets/js/avatar.js"></script></html>